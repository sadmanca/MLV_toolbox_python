
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tabulate &#8212; MLV_toolbox_python 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for tabulate</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Pretty-print tabular data.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sized</span>
<span class="kn">from</span> <span class="nn">html</span> <span class="kn">import</span> <span class="n">escape</span> <span class="k">as</span> <span class="n">htmlescape</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span><span class="p">,</span> <span class="n">zip_longest</span> <span class="k">as</span> <span class="n">izip_longest</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span><span class="p">,</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">dataclasses</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">wcwidth</span>  <span class="c1"># optional wide-character (CJK) support</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">wcwidth</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_is_file</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">IOBase</span><span class="p">)</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tabulate&quot;</span><span class="p">,</span> <span class="s2">&quot;tabulate_formats&quot;</span><span class="p">,</span> <span class="s2">&quot;simple_separated_format&quot;</span><span class="p">]</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">.version</span> <span class="kn">import</span> <span class="n">version</span> <span class="k">as</span> <span class="n">__version__</span>  <span class="c1"># noqa: F401</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>  <span class="c1"># running __init__.py as a script, AppVeyor pytests</span>


<span class="c1"># minimum extra space in headers</span>
<span class="n">MIN_PADDING</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Whether or not to preserve leading/trailing whitespace in data.</span>
<span class="n">PRESERVE_WHITESPACE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="n">_DEFAULT_FLOATFMT</span> <span class="o">=</span> <span class="s2">&quot;g&quot;</span>
<span class="n">_DEFAULT_INTFMT</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">_DEFAULT_MISSINGVAL</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="c1"># default align will be overwritten by &quot;left&quot;, &quot;center&quot; or &quot;decimal&quot;</span>
<span class="c1"># depending on the formatter</span>
<span class="n">_DEFAULT_ALIGN</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>


<span class="c1"># if True, enable wide-character (CJK) support</span>
<span class="n">WIDE_CHARS_MODE</span> <span class="o">=</span> <span class="n">wcwidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="c1"># Constant that can be used as part of passed rows to generate a separating line</span>
<span class="c1"># It is purposely an unprintable character, very unlikely to be used in a table</span>
<span class="n">SEPARATING_LINE</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\001</span><span class="s2">&quot;</span>

<span class="n">Line</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;Line&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;begin&quot;</span><span class="p">,</span> <span class="s2">&quot;hline&quot;</span><span class="p">,</span> <span class="s2">&quot;sep&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">])</span>


<span class="n">DataRow</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;DataRow&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;begin&quot;</span><span class="p">,</span> <span class="s2">&quot;sep&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">])</span>


<span class="c1"># A table structure is supposed to be:</span>
<span class="c1">#</span>
<span class="c1">#     --- lineabove ---------</span>
<span class="c1">#         headerrow</span>
<span class="c1">#     --- linebelowheader ---</span>
<span class="c1">#         datarow</span>
<span class="c1">#     --- linebetweenrows ---</span>
<span class="c1">#     ... (more datarows) ...</span>
<span class="c1">#     --- linebetweenrows ---</span>
<span class="c1">#         last datarow</span>
<span class="c1">#     --- linebelow ---------</span>
<span class="c1">#</span>
<span class="c1"># TableFormat&#39;s line* elements can be</span>
<span class="c1">#</span>
<span class="c1">#   - either None, if the element is not used,</span>
<span class="c1">#   - or a Line tuple,</span>
<span class="c1">#   - or a function: [col_widths], [col_alignments] -&gt; string.</span>
<span class="c1">#</span>
<span class="c1"># TableFormat&#39;s *row elements can be</span>
<span class="c1">#</span>
<span class="c1">#   - either None, if the element is not used,</span>
<span class="c1">#   - or a DataRow tuple,</span>
<span class="c1">#   - or a function: [cell_values], [col_widths], [col_alignments] -&gt; string.</span>
<span class="c1">#</span>
<span class="c1"># padding (an integer) is the amount of white space around data values.</span>
<span class="c1">#</span>
<span class="c1"># with_header_hide:</span>
<span class="c1">#</span>
<span class="c1">#   - either None, to display all table elements unconditionally,</span>
<span class="c1">#   - or a list of elements not to be displayed if the table has column headers.</span>
<span class="c1">#</span>
<span class="n">TableFormat</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;TableFormat&quot;</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;lineabove&quot;</span><span class="p">,</span>
        <span class="s2">&quot;linebelowheader&quot;</span><span class="p">,</span>
        <span class="s2">&quot;linebetweenrows&quot;</span><span class="p">,</span>
        <span class="s2">&quot;linebelow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;headerrow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;datarow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;padding&quot;</span><span class="p">,</span>
        <span class="s2">&quot;with_header_hide&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">_is_separating_line</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">row_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">is_sl</span> <span class="o">=</span> <span class="p">(</span><span class="n">row_type</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="n">row_type</span> <span class="o">==</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEPARATING_LINE</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">SEPARATING_LINE</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">is_sl</span>


<span class="k">def</span> <span class="nf">_pipe_segment_with_colons</span><span class="p">(</span><span class="n">align</span><span class="p">,</span> <span class="n">colwidth</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a segment of a horizontal line with optional colons which</span>
<span class="sd">    indicate column&#39;s alignment (as in `pipe` output format).&quot;&quot;&quot;</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">colwidth</span>
    <span class="k">if</span> <span class="n">align</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;decimal&quot;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
    <span class="k">elif</span> <span class="n">align</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
    <span class="k">elif</span> <span class="n">align</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="n">w</span>


<span class="k">def</span> <span class="nf">_pipe_line_with_colons</span><span class="p">(</span><span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a horizontal line with optional colons to indicate column&#39;s</span>
<span class="sd">    alignment (as in `pipe` output format).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">colaligns</span><span class="p">:</span>  <span class="c1"># e.g. printing an empty data frame (github issue #15)</span>
        <span class="n">colaligns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">colwidths</span><span class="p">)</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[</span><span class="n">_pipe_segment_with_colons</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colaligns</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">)]</span>
    <span class="k">return</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span>


<span class="k">def</span> <span class="nf">_mediawiki_row_with_attrs</span><span class="p">(</span><span class="n">separator</span><span class="p">,</span> <span class="n">cell_values</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">):</span>
    <span class="n">alignment</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="s1">&#39;align=&quot;right&quot;| &#39;</span><span class="p">,</span>
        <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="s1">&#39;align=&quot;center&quot;| &#39;</span><span class="p">,</span>
        <span class="s2">&quot;decimal&quot;</span><span class="p">:</span> <span class="s1">&#39;align=&quot;right&quot;| &#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="c1"># hard-coded padding _around_ align attribute and value together</span>
    <span class="c1"># rather than padding parameter which affects only the value</span>
    <span class="n">values_with_attrs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">alignment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cell_values</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">colsep</span> <span class="o">=</span> <span class="n">separator</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">separator</span> <span class="o">+</span> <span class="n">colsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">values_with_attrs</span><span class="p">))</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_textile_row_with_attrs</span><span class="p">(</span><span class="n">cell_values</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">):</span>
    <span class="n">cell_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span>
    <span class="n">alignment</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;.&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;.&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="s2">&quot;=.&quot;</span><span class="p">,</span> <span class="s2">&quot;decimal&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;.&quot;</span><span class="p">}</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="n">alignment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colaligns</span><span class="p">,</span> <span class="n">cell_values</span><span class="p">))</span>
    <span class="k">return</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span>


<span class="k">def</span> <span class="nf">_html_begin_table_without_header</span><span class="p">(</span><span class="n">colwidths_ignore</span><span class="p">,</span> <span class="n">colaligns_ignore</span><span class="p">):</span>
    <span class="c1"># this table header will be suppressed if there is a header row</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;table&gt;</span><span class="se">\n</span><span class="s2">&lt;tbody&gt;&quot;</span>


<span class="k">def</span> <span class="nf">_html_row_with_attrs</span><span class="p">(</span><span class="n">celltag</span><span class="p">,</span> <span class="n">unsafe</span><span class="p">,</span> <span class="n">cell_values</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">):</span>
    <span class="n">alignment</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="s1">&#39; style=&quot;text-align: right;&quot;&#39;</span><span class="p">,</span>
        <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="s1">&#39; style=&quot;text-align: center;&quot;&#39;</span><span class="p">,</span>
        <span class="s2">&quot;decimal&quot;</span><span class="p">:</span> <span class="s1">&#39; style=&quot;text-align: right;&quot;&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">unsafe</span><span class="p">:</span>
        <span class="n">values_with_attrs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;&lt;</span><span class="si">{0}{1}</span><span class="s2">&gt;</span><span class="si">{2}</span><span class="s2">&lt;/</span><span class="si">{0}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">celltag</span><span class="p">,</span> <span class="n">alignment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cell_values</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">values_with_attrs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;&lt;</span><span class="si">{0}{1}</span><span class="s2">&gt;</span><span class="si">{2}</span><span class="s2">&lt;/</span><span class="si">{0}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">celltag</span><span class="p">,</span> <span class="n">alignment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">htmlescape</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cell_values</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="n">rowhtml</span> <span class="o">=</span> <span class="s2">&quot;&lt;tr&gt;</span><span class="si">{}</span><span class="s2">&lt;/tr&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">values_with_attrs</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">celltag</span> <span class="o">==</span> <span class="s2">&quot;th&quot;</span><span class="p">:</span>  <span class="c1"># it&#39;s a header row, create a new table header</span>
        <span class="n">rowhtml</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;table&gt;</span><span class="se">\n</span><span class="s2">&lt;thead&gt;</span><span class="se">\n</span><span class="si">{</span><span class="n">rowhtml</span><span class="si">}</span><span class="se">\n</span><span class="s2">&lt;/thead&gt;</span><span class="se">\n</span><span class="s2">&lt;tbody&gt;&quot;</span>
    <span class="k">return</span> <span class="n">rowhtml</span>


<span class="k">def</span> <span class="nf">_moin_row_with_attrs</span><span class="p">(</span><span class="n">celltag</span><span class="p">,</span> <span class="n">cell_values</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">alignment</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="s1">&#39;&lt;style=&quot;text-align: right;&quot;&gt;&#39;</span><span class="p">,</span>
        <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="s1">&#39;&lt;style=&quot;text-align: center;&quot;&gt;&#39;</span><span class="p">,</span>
        <span class="s2">&quot;decimal&quot;</span><span class="p">:</span> <span class="s1">&#39;&lt;style=&quot;text-align: right;&quot;&gt;&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">values_with_attrs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;</span><span class="si">{}{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">celltag</span><span class="p">,</span> <span class="n">alignment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">header</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="n">header</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cell_values</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">values_with_attrs</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;||&quot;</span>


<span class="k">def</span> <span class="nf">_latex_line_begin_tabular</span><span class="p">(</span><span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">booktabs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">longtable</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">alignment</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;decimal&quot;</span><span class="p">:</span> <span class="s2">&quot;r&quot;</span><span class="p">}</span>
    <span class="n">tabular_columns_fmt</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">alignment</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">colaligns</span><span class="p">])</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{tabular}</span><span class="s2">{&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">longtable</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">begin</span><span class="si">{longtable}</span><span class="s2">{&quot;</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">tabular_columns_fmt</span>
            <span class="o">+</span> <span class="s2">&quot;}&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">toprule&quot;</span> <span class="k">if</span> <span class="n">booktabs</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">hline&quot;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_asciidoc_row</span><span class="p">(</span><span class="n">is_header</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;handle header and data rows for asciidoc format&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">make_header_line</span><span class="p">(</span><span class="n">is_header</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">):</span>
        <span class="c1"># generate the column specifiers</span>

        <span class="n">alignment</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span> <span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;decimal&quot;</span><span class="p">:</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">}</span>
        <span class="c1"># use the column widths generated by tabulate for the asciidoc column width specifiers</span>
        <span class="n">asciidoc_alignments</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">colwidths</span><span class="p">,</span> <span class="p">[</span><span class="n">alignment</span><span class="p">[</span><span class="n">colalign</span><span class="p">]</span> <span class="k">for</span> <span class="n">colalign</span> <span class="ow">in</span> <span class="n">colaligns</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">asciidoc_column_specifiers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;</span><span class="si">{:d}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">align</span><span class="p">)</span> <span class="k">for</span> <span class="n">width</span><span class="p">,</span> <span class="n">align</span> <span class="ow">in</span> <span class="n">asciidoc_alignments</span>
        <span class="p">]</span>
        <span class="n">header_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cols=&quot;&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">asciidoc_column_specifiers</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">]</span>

        <span class="c1"># generate the list of options (currently only &quot;header&quot;)</span>
        <span class="n">options_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">is_header</span><span class="p">:</span>
            <span class="n">options_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">options_list</span><span class="p">:</span>
            <span class="n">header_list</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;options=&quot;&#39;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options_list</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">]</span>

        <span class="c1"># generate the list of entries in the table header field</span>

        <span class="k">return</span> <span class="s2">&quot;[</span><span class="si">{}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">|====&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">header_list</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># two arguments are passed if called in the context of aboveline</span>
        <span class="c1"># print the table header with column widths and optional header tag</span>
        <span class="k">return</span> <span class="n">make_header_line</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1"># three arguments are passed if called in the context of dataline or headerline</span>
        <span class="c1"># print the table line and make the aboveline if it is a header</span>

        <span class="n">cell_values</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span> <span class="o">=</span> <span class="n">args</span>
        <span class="n">data_line</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cell_values</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_header</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">make_header_line</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">data_line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data_line</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot; _asciidoc_row() requires two (colwidths, colaligns) &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;or three (cell_values, colwidths, colaligns) arguments) &quot;</span>
        <span class="p">)</span>


<span class="n">LATEX_ESCAPE_RULES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sa">r</span><span class="s2">&quot;&amp;&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\&amp;&quot;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s2">&quot;%&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\%&quot;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s2">&quot;$&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\$&quot;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s2">&quot;#&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\#&quot;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s2">&quot;_&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\_&quot;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s2">&quot;^&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\^</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s2">&quot;{&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\{&quot;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s2">&quot;}&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\}&quot;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s2">&quot;~&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\textasciitilde</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\textbackslash</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s2">&quot;&lt;&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\ensuremath{&lt;}&quot;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;\ensuremath{&gt;}&quot;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">_latex_row</span><span class="p">(</span><span class="n">cell_values</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">escrules</span><span class="o">=</span><span class="n">LATEX_ESCAPE_RULES</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">escape_char</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">escrules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="n">escaped_values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">escape_char</span><span class="p">,</span> <span class="n">cell</span><span class="p">))</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_values</span><span class="p">]</span>
    <span class="n">rowfmt</span> <span class="o">=</span> <span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_build_simple_row</span><span class="p">(</span><span class="n">escaped_values</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_rst_escape_first_column</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">escape_empty</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;..&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val</span>

    <span class="n">new_headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
    <span class="n">new_rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
        <span class="n">new_headers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">escape_empty</span><span class="p">(</span><span class="n">headers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_row</span><span class="p">:</span>
            <span class="n">new_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">escape_empty</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">new_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_rows</span><span class="p">,</span> <span class="n">new_headers</span>


<span class="n">_table_formats</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;simple&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lineabove&quot;</span><span class="p">,</span> <span class="s2">&quot;linebelow&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="s2">&quot;plain&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;simple_grid&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┌&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┬&quot;</span><span class="p">,</span> <span class="s2">&quot;┐&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;├&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┼&quot;</span><span class="p">,</span> <span class="s2">&quot;┤&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;├&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┼&quot;</span><span class="p">,</span> <span class="s2">&quot;┤&quot;</span><span class="p">),</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;└&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┴&quot;</span><span class="p">,</span> <span class="s2">&quot;┘&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;rounded_grid&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╭&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┬&quot;</span><span class="p">,</span> <span class="s2">&quot;╮&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;├&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┼&quot;</span><span class="p">,</span> <span class="s2">&quot;┤&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;├&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┼&quot;</span><span class="p">,</span> <span class="s2">&quot;┤&quot;</span><span class="p">),</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╰&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┴&quot;</span><span class="p">,</span> <span class="s2">&quot;╯&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;heavy_grid&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┏&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;┳&quot;</span><span class="p">,</span> <span class="s2">&quot;┓&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┣&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;╋&quot;</span><span class="p">,</span> <span class="s2">&quot;┫&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┣&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;╋&quot;</span><span class="p">,</span> <span class="s2">&quot;┫&quot;</span><span class="p">),</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┗&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;┻&quot;</span><span class="p">,</span> <span class="s2">&quot;┛&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;┃&quot;</span><span class="p">,</span> <span class="s2">&quot;┃&quot;</span><span class="p">,</span> <span class="s2">&quot;┃&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;┃&quot;</span><span class="p">,</span> <span class="s2">&quot;┃&quot;</span><span class="p">,</span> <span class="s2">&quot;┃&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;mixed_grid&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┍&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;┯&quot;</span><span class="p">,</span> <span class="s2">&quot;┑&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┝&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;┿&quot;</span><span class="p">,</span> <span class="s2">&quot;┥&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;├&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┼&quot;</span><span class="p">,</span> <span class="s2">&quot;┤&quot;</span><span class="p">),</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┕&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;┷&quot;</span><span class="p">,</span> <span class="s2">&quot;┙&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;double_grid&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╔&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╦&quot;</span><span class="p">,</span> <span class="s2">&quot;╗&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╠&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╬&quot;</span><span class="p">,</span> <span class="s2">&quot;╣&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╠&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╬&quot;</span><span class="p">,</span> <span class="s2">&quot;╣&quot;</span><span class="p">),</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╚&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╩&quot;</span><span class="p">,</span> <span class="s2">&quot;╝&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;║&quot;</span><span class="p">,</span> <span class="s2">&quot;║&quot;</span><span class="p">,</span> <span class="s2">&quot;║&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;║&quot;</span><span class="p">,</span> <span class="s2">&quot;║&quot;</span><span class="p">,</span> <span class="s2">&quot;║&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;fancy_grid&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╒&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╤&quot;</span><span class="p">,</span> <span class="s2">&quot;╕&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╞&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╪&quot;</span><span class="p">,</span> <span class="s2">&quot;╡&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;├&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┼&quot;</span><span class="p">,</span> <span class="s2">&quot;┤&quot;</span><span class="p">),</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╘&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╧&quot;</span><span class="p">,</span> <span class="s2">&quot;╛&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;outline&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;simple_outline&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┌&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┬&quot;</span><span class="p">,</span> <span class="s2">&quot;┐&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;├&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┼&quot;</span><span class="p">,</span> <span class="s2">&quot;┤&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;└&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┴&quot;</span><span class="p">,</span> <span class="s2">&quot;┘&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;rounded_outline&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╭&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┬&quot;</span><span class="p">,</span> <span class="s2">&quot;╮&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;├&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┼&quot;</span><span class="p">,</span> <span class="s2">&quot;┤&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╰&quot;</span><span class="p">,</span> <span class="s2">&quot;─&quot;</span><span class="p">,</span> <span class="s2">&quot;┴&quot;</span><span class="p">,</span> <span class="s2">&quot;╯&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;heavy_outline&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┏&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;┳&quot;</span><span class="p">,</span> <span class="s2">&quot;┓&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┣&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;╋&quot;</span><span class="p">,</span> <span class="s2">&quot;┫&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┗&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;┻&quot;</span><span class="p">,</span> <span class="s2">&quot;┛&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;┃&quot;</span><span class="p">,</span> <span class="s2">&quot;┃&quot;</span><span class="p">,</span> <span class="s2">&quot;┃&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;┃&quot;</span><span class="p">,</span> <span class="s2">&quot;┃&quot;</span><span class="p">,</span> <span class="s2">&quot;┃&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;mixed_outline&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┍&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;┯&quot;</span><span class="p">,</span> <span class="s2">&quot;┑&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┝&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;┿&quot;</span><span class="p">,</span> <span class="s2">&quot;┥&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;┕&quot;</span><span class="p">,</span> <span class="s2">&quot;━&quot;</span><span class="p">,</span> <span class="s2">&quot;┷&quot;</span><span class="p">,</span> <span class="s2">&quot;┙&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;double_outline&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╔&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╦&quot;</span><span class="p">,</span> <span class="s2">&quot;╗&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╠&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╬&quot;</span><span class="p">,</span> <span class="s2">&quot;╣&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╚&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╩&quot;</span><span class="p">,</span> <span class="s2">&quot;╝&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;║&quot;</span><span class="p">,</span> <span class="s2">&quot;║&quot;</span><span class="p">,</span> <span class="s2">&quot;║&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;║&quot;</span><span class="p">,</span> <span class="s2">&quot;║&quot;</span><span class="p">,</span> <span class="s2">&quot;║&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;fancy_outline&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╒&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╤&quot;</span><span class="p">,</span> <span class="s2">&quot;╕&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╞&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╪&quot;</span><span class="p">,</span> <span class="s2">&quot;╡&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;╘&quot;</span><span class="p">,</span> <span class="s2">&quot;═&quot;</span><span class="p">,</span> <span class="s2">&quot;╧&quot;</span><span class="p">,</span> <span class="s2">&quot;╛&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">,</span> <span class="s2">&quot;│&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;github&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lineabove&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="s2">&quot;pipe&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">_pipe_line_with_colons</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">_pipe_line_with_colons</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lineabove&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="s2">&quot;orgtbl&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;jira&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;||&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;presto&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;pretty&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;psql&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;rst&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;  &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;mediawiki&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span>
            <span class="s1">&#39;{| class=&quot;wikitable&quot; style=&quot;text-align: left;&quot;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">|+ &lt;!-- caption --&gt;</span><span class="se">\n</span><span class="s2">|-&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;|-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;|-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;|}&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_mediawiki_row_with_attrs</span><span class="p">,</span> <span class="s2">&quot;!&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_mediawiki_row_with_attrs</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;moinmoin&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_moin_row_with_attrs</span><span class="p">,</span> <span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;&#39;&#39;&#39;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_moin_row_with_attrs</span><span class="p">,</span> <span class="s2">&quot;||&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;youtrack&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|| &quot;</span><span class="p">,</span> <span class="s2">&quot; || &quot;</span><span class="p">,</span> <span class="s2">&quot; || &quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;| &quot;</span><span class="p">,</span> <span class="s2">&quot; | &quot;</span><span class="p">,</span> <span class="s2">&quot; |&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">_html_begin_table_without_header</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&lt;/tbody&gt;</span><span class="se">\n</span><span class="s2">&lt;/table&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_html_row_with_attrs</span><span class="p">,</span> <span class="s2">&quot;th&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_html_row_with_attrs</span><span class="p">,</span> <span class="s2">&quot;td&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lineabove&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="s2">&quot;unsafehtml&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">_html_begin_table_without_header</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&lt;/tbody&gt;</span><span class="se">\n</span><span class="s2">&lt;/table&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_html_row_with_attrs</span><span class="p">,</span> <span class="s2">&quot;th&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_html_row_with_attrs</span><span class="p">,</span> <span class="s2">&quot;td&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lineabove&quot;</span><span class="p">],</span>
    <span class="p">),</span>
    <span class="s2">&quot;latex&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">_latex_line_begin_tabular</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">hline&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">hline</span><span class="se">\n\\</span><span class="s2">end</span><span class="si">{tabular}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">_latex_row</span><span class="p">,</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">_latex_row</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;latex_raw&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">_latex_line_begin_tabular</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">hline&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">hline</span><span class="se">\n\\</span><span class="s2">end</span><span class="si">{tabular}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_latex_row</span><span class="p">,</span> <span class="n">escrules</span><span class="o">=</span><span class="p">{}),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_latex_row</span><span class="p">,</span> <span class="n">escrules</span><span class="o">=</span><span class="p">{}),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;latex_booktabs&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_latex_line_begin_tabular</span><span class="p">,</span> <span class="n">booktabs</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">midrule&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">bottomrule</span><span class="se">\n\\</span><span class="s2">end</span><span class="si">{tabular}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">_latex_row</span><span class="p">,</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">_latex_row</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;latex_longtable&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_latex_line_begin_tabular</span><span class="p">,</span> <span class="n">longtable</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">hline</span><span class="se">\n\\</span><span class="s2">endhead&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">hline</span><span class="se">\n\\</span><span class="s2">end</span><span class="si">{longtable}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">_latex_row</span><span class="p">,</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">_latex_row</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;tsv&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;textile&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;|_. &quot;</span><span class="p">,</span> <span class="s2">&quot;|_.&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">_textile_row_with_attrs</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="s2">&quot;asciidoc&quot;</span><span class="p">:</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="n">lineabove</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_asciidoc_row</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">linebelowheader</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebetweenrows</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linebelow</span><span class="o">=</span><span class="n">Line</span><span class="p">(</span><span class="s2">&quot;|====&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_asciidoc_row</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">_asciidoc_row</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;lineabove&quot;</span><span class="p">],</span>
    <span class="p">),</span>
<span class="p">}</span>


<span class="n">tabulate_formats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">_table_formats</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

<span class="c1"># The table formats for which multiline cells will be folded into subsequent</span>
<span class="c1"># table rows. The key is the original format specified at the API. The value is</span>
<span class="c1"># the format that will be used to represent the original format.</span>
<span class="n">multiline_formats</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;plain&quot;</span><span class="p">:</span> <span class="s2">&quot;plain&quot;</span><span class="p">,</span>
    <span class="s2">&quot;simple&quot;</span><span class="p">:</span> <span class="s2">&quot;simple&quot;</span><span class="p">,</span>
    <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;simple_grid&quot;</span><span class="p">:</span> <span class="s2">&quot;simple_grid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rounded_grid&quot;</span><span class="p">:</span> <span class="s2">&quot;rounded_grid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;heavy_grid&quot;</span><span class="p">:</span> <span class="s2">&quot;heavy_grid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mixed_grid&quot;</span><span class="p">:</span> <span class="s2">&quot;mixed_grid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;double_grid&quot;</span><span class="p">:</span> <span class="s2">&quot;double_grid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fancy_grid&quot;</span><span class="p">:</span> <span class="s2">&quot;fancy_grid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pipe&quot;</span><span class="p">:</span> <span class="s2">&quot;pipe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;orgtbl&quot;</span><span class="p">:</span> <span class="s2">&quot;orgtbl&quot;</span><span class="p">,</span>
    <span class="s2">&quot;jira&quot;</span><span class="p">:</span> <span class="s2">&quot;jira&quot;</span><span class="p">,</span>
    <span class="s2">&quot;presto&quot;</span><span class="p">:</span> <span class="s2">&quot;presto&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pretty&quot;</span><span class="p">:</span> <span class="s2">&quot;pretty&quot;</span><span class="p">,</span>
    <span class="s2">&quot;psql&quot;</span><span class="p">:</span> <span class="s2">&quot;psql&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rst&quot;</span><span class="p">:</span> <span class="s2">&quot;rst&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># TODO: Add multiline support for the remaining table formats:</span>
<span class="c1">#       - mediawiki: Replace \n with &lt;br&gt;</span>
<span class="c1">#       - moinmoin: TBD</span>
<span class="c1">#       - youtrack: TBD</span>
<span class="c1">#       - html: Replace \n with &lt;br&gt;</span>
<span class="c1">#       - latex*: Use &quot;makecell&quot; package: In header, replace X\nY with</span>
<span class="c1">#         \thead{X\\Y} and in data row, replace X\nY with \makecell{X\\Y}</span>
<span class="c1">#       - tsv: TBD</span>
<span class="c1">#       - textile: Replace \n with &lt;br/&gt; (must be well-formed XML)</span>

<span class="n">_multiline_codes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\r|\n|\r\n&quot;</span><span class="p">)</span>
<span class="n">_multiline_codes_bytes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">|</span><span class="se">\n</span><span class="s2">|</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Handle ANSI escape sequences for both control sequence introducer (CSI) and</span>
<span class="c1"># operating system command (OSC). Both of these begin with 0x1b (or octal 033),</span>
<span class="c1"># which will be shown below as ESC.</span>
<span class="c1">#</span>
<span class="c1"># CSI ANSI escape codes have the following format, defined in section 5.4 of ECMA-48:</span>
<span class="c1">#</span>
<span class="c1"># CSI: ESC followed by the &#39;[&#39; character (0x5b)</span>
<span class="c1"># Parameter Bytes: 0..n bytes in the range 0x30-0x3f</span>
<span class="c1"># Intermediate Bytes: 0..n bytes in the range 0x20-0x2f</span>
<span class="c1"># Final Byte: a single byte in the range 0x40-0x7e</span>
<span class="c1">#</span>
<span class="c1"># Also include the terminal hyperlink sequences as described here:</span>
<span class="c1"># https://gist.github.com/egmontkob/eb114294efbcd5adb1944c9f3cb5feda</span>
<span class="c1">#</span>
<span class="c1"># OSC 8 ; params ; uri ST display_text OSC 8 ;; ST</span>
<span class="c1">#</span>
<span class="c1"># Example: \x1b]8;;https://example.com\x5ctext to show\x1b]8;;\x5c</span>
<span class="c1">#</span>
<span class="c1"># Where:</span>
<span class="c1"># OSC: ESC followed by the &#39;]&#39; character (0x5d)</span>
<span class="c1"># params: 0..n optional key value pairs separated by &#39;:&#39; (e.g. foo=bar:baz=qux:abc=123)</span>
<span class="c1"># URI: the actual URI with protocol scheme (e.g. https://, file://, ftp://)</span>
<span class="c1"># ST: ESC followed by the &#39;\&#39; character (0x5c)</span>
<span class="n">_esc</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\x1b&quot;</span>
<span class="n">_csi</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_esc</span><span class="si">}</span><span class="s2">\[&quot;</span>
<span class="n">_osc</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_esc</span><span class="si">}</span><span class="s2">\]&quot;</span>
<span class="n">_st</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_esc</span><span class="si">}</span><span class="se">\\</span><span class="s2">&quot;</span>

<span class="n">_ansi_escape_pat</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    (</span>
<span class="s2">        # terminal colors, etc</span>
<span class="s2">        </span><span class="si">{</span><span class="n">_csi</span><span class="si">}</span><span class="s2">        # CSI</span>
<span class="s2">        [\x30-\x3f]*  # parameter bytes</span>
<span class="s2">        [\x20-\x2f]*  # intermediate bytes</span>
<span class="s2">        [\x40-\x7e]   # final byte</span>
<span class="s2">    |</span>
<span class="s2">        # terminal hyperlinks</span>
<span class="s2">        </span><span class="si">{</span><span class="n">_osc</span><span class="si">}</span><span class="s2">8;        # OSC opening</span>
<span class="s2">        (\w+=\w+:?)*    # key=value params list (submatch 2)</span>
<span class="s2">        ;               # delimiter</span>
<span class="s2">        ([^</span><span class="si">{</span><span class="n">_esc</span><span class="si">}</span><span class="s2">]+)    # URI - anything but ESC (submatch 3)</span>
<span class="s2">        </span><span class="si">{</span><span class="n">_st</span><span class="si">}</span><span class="s2">           # ST</span>
<span class="s2">        ([^</span><span class="si">{</span><span class="n">_esc</span><span class="si">}</span><span class="s2">]+)    # link text - anything but ESC (submatch 4)</span>
<span class="s2">        </span><span class="si">{</span><span class="n">_osc</span><span class="si">}</span><span class="s2">8;;</span><span class="si">{</span><span class="n">_st</span><span class="si">}</span><span class="s2">  # &quot;closing&quot; OSC sequence</span>
<span class="s2">    )</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">_ansi_codes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">_ansi_escape_pat</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">_ansi_codes_bytes</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">_ansi_escape_pat</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">),</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">_ansi_color_reset_code</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>

<span class="n">_float_with_thousands_separators</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;^(([+-]?[0-9]{1,3})(?:,([0-9]</span><span class="si">{3}</span><span class="s2">))*)?(?(1)\.[0-9]*|\.[0-9]+)?$&quot;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">simple_separated_format</span><span class="p">(</span><span class="n">separator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a simple TableFormat with columns separated by a separator.</span>

<span class="sd">    &gt;&gt;&gt; tsv = simple_separated_format(&quot;\\t&quot;) ; \</span>
<span class="sd">        tabulate([[&quot;foo&quot;, 1], [&quot;spam&quot;, 23]], tablefmt=tsv) == &#39;foo \\t 1\\nspam\\t23&#39;</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">TableFormat</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">headerrow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">datarow</span><span class="o">=</span><span class="n">DataRow</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">with_header_hide</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_isnumber_with_thousands_separator</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; _isnumber_with_thousands_separator(&quot;.&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; _isnumber_with_thousands_separator(&quot;1&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumber_with_thousands_separator(&quot;1.&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumber_with_thousands_separator(&quot;.1&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumber_with_thousands_separator(&quot;1000&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; _isnumber_with_thousands_separator(&quot;1,000&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumber_with_thousands_separator(&quot;1,0000&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; _isnumber_with_thousands_separator(&quot;1,000.1234&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumber_with_thousands_separator(b&quot;1,000.1234&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumber_with_thousands_separator(&quot;+1,000.1234&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumber_with_thousands_separator(&quot;-1,000.1234&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">UnicodeDecodeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_float_with_thousands_separators</span><span class="p">,</span> <span class="n">string</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_isconvertible</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">conv</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_isnumber</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; _isnumber(&quot;123.45&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumber(&quot;123&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isnumber(&quot;spam&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; _isnumber(&quot;123e45678&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; _isnumber(&quot;inf&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_isconvertible</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">math</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="p">))</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;inf&quot;</span><span class="p">,</span> <span class="s2">&quot;-inf&quot;</span><span class="p">,</span> <span class="s2">&quot;nan&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">_isint</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">inttype</span><span class="o">=</span><span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; _isint(&quot;123&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isint(&quot;123.45&quot;)</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="nb">type</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">is</span> <span class="n">inttype</span>
        <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
        <span class="ow">and</span> <span class="n">_isconvertible</span><span class="p">(</span><span class="n">inttype</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_isbool</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; _isbool(True)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isbool(&quot;False&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _isbool(1)</span>
<span class="sd">    False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span> <span class="ow">or</span> <span class="p">(</span>
        <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span> <span class="ow">and</span> <span class="n">string</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_type</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">has_invisible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">numparse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The least generic type (type(None), int, float, str, unicode).</span>

<span class="sd">    &gt;&gt;&gt; _type(None) is type(None)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _type(&quot;foo&quot;) is type(&quot;&quot;)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _type(&quot;1&quot;) is type(1)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _type(&#39;\x1b[31m42\x1b[0m&#39;) is type(42)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _type(&#39;\x1b[31m42\x1b[0m&#39;) is type(42)</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">has_invisible</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="n">_strip_ansi</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">string</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s2">&quot;isoformat&quot;</span><span class="p">):</span>  <span class="c1"># datetime.datetime, date, and time</span>
        <span class="k">return</span> <span class="nb">str</span>
    <span class="k">elif</span> <span class="n">_isbool</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span>
    <span class="k">elif</span> <span class="n">_isint</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">numparse</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span>
    <span class="k">elif</span> <span class="n">_isnumber</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">and</span> <span class="n">numparse</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bytes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span>


<span class="k">def</span> <span class="nf">_afterpoint</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Symbols after a decimal point, -1 if the string lacks the decimal point.</span>

<span class="sd">    &gt;&gt;&gt; _afterpoint(&quot;123.45&quot;)</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; _afterpoint(&quot;1001&quot;)</span>
<span class="sd">    -1</span>
<span class="sd">    &gt;&gt;&gt; _afterpoint(&quot;eggs&quot;)</span>
<span class="sd">    -1</span>
<span class="sd">    &gt;&gt;&gt; _afterpoint(&quot;123e45&quot;)</span>
<span class="sd">    2</span>
<span class="sd">    &gt;&gt;&gt; _afterpoint(&quot;123,456.78&quot;)</span>
<span class="sd">    2</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">_isnumber</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_isnumber_with_thousands_separator</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_isint</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">pos</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">-</span> <span class="n">pos</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># no point</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># not a number</span>


<span class="k">def</span> <span class="nf">_padleft</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flush right.</span>

<span class="sd">    &gt;&gt;&gt; _padleft(6, &#39;\u044f\u0439\u0446\u0430&#39;) == &#39;  \u044f\u0439\u0446\u0430&#39;</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;{0:&gt;</span><span class="si">%d</span><span class="s2">s}&quot;</span> <span class="o">%</span> <span class="n">width</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_padright</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flush left.</span>

<span class="sd">    &gt;&gt;&gt; _padright(6, &#39;\u044f\u0439\u0446\u0430&#39;) == &#39;\u044f\u0439\u0446\u0430  &#39;</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;{0:&lt;</span><span class="si">%d</span><span class="s2">s}&quot;</span> <span class="o">%</span> <span class="n">width</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_padboth</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Center string.</span>

<span class="sd">    &gt;&gt;&gt; _padboth(6, &#39;\u044f\u0439\u0446\u0430&#39;) == &#39; \u044f\u0439\u0446\u0430 &#39;</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;{0:^</span><span class="si">%d</span><span class="s2">s}&quot;</span> <span class="o">%</span> <span class="n">width</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_padnone</span><span class="p">(</span><span class="n">ignore_width</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span>


<span class="k">def</span> <span class="nf">_strip_ansi</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Remove ANSI escape sequences, both CSI (color codes, etc) and OSC hyperlinks.</span>

<span class="sd">    CSI sequences are simply removed from the output, while OSC hyperlinks are replaced</span>
<span class="sd">    with the link text. Note: it may be desirable to show the URI instead but this is not</span>
<span class="sd">    supported.</span>

<span class="sd">    &gt;&gt;&gt; repr(_strip_ansi(&#39;\x1B]8;;https://example.com\x1B\\This is a link\x1B]8;;\x1B\\&#39;))</span>
<span class="sd">    &quot;&#39;This is a link&#39;&quot;</span>

<span class="sd">    &gt;&gt;&gt; repr(_strip_ansi(&#39;\x1b[31mred\x1b[0m text&#39;))</span>
<span class="sd">    &quot;&#39;red text&#39;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_ansi_codes</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\4&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># a bytestring</span>
        <span class="k">return</span> <span class="n">_ansi_codes_bytes</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\4&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_visible_width</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visible width of a printed string. ANSI color codes are removed.</span>

<span class="sd">    &gt;&gt;&gt; _visible_width(&#39;\x1b[31mhello\x1b[0m&#39;), _visible_width(&quot;world&quot;)</span>
<span class="sd">    (5, 5)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># optional wide-character support</span>
    <span class="k">if</span> <span class="n">wcwidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">WIDE_CHARS_MODE</span><span class="p">:</span>
        <span class="n">len_fn</span> <span class="o">=</span> <span class="n">wcwidth</span><span class="o">.</span><span class="n">wcswidth</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">len_fn</span> <span class="o">=</span> <span class="nb">len</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">len_fn</span><span class="p">(</span><span class="n">_strip_ansi</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">len_fn</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_is_multiline</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">_multiline_codes</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># a bytestring</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">_multiline_codes_bytes</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_multiline_width</span><span class="p">(</span><span class="n">multiline_s</span><span class="p">,</span> <span class="n">line_width_fn</span><span class="o">=</span><span class="nb">len</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visible width of a potentially multiline content.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">line_width_fn</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[</span><span class="se">\r\n</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">multiline_s</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">_choose_width_fn</span><span class="p">(</span><span class="n">has_invisible</span><span class="p">,</span> <span class="n">enable_widechars</span><span class="p">,</span> <span class="n">is_multiline</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a function to calculate visible cell width.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">has_invisible</span><span class="p">:</span>
        <span class="n">line_width_fn</span> <span class="o">=</span> <span class="n">_visible_width</span>
    <span class="k">elif</span> <span class="n">enable_widechars</span><span class="p">:</span>  <span class="c1"># optional wide-character support if available</span>
        <span class="n">line_width_fn</span> <span class="o">=</span> <span class="n">wcwidth</span><span class="o">.</span><span class="n">wcswidth</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_width_fn</span> <span class="o">=</span> <span class="nb">len</span>
    <span class="k">if</span> <span class="n">is_multiline</span><span class="p">:</span>
        <span class="n">width_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">_multiline_width</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">line_width_fn</span><span class="p">)</span>  <span class="c1"># noqa</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">width_fn</span> <span class="o">=</span> <span class="n">line_width_fn</span>
    <span class="k">return</span> <span class="n">width_fn</span>


<span class="k">def</span> <span class="nf">_align_column_choose_padfn</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">has_invisible</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">PRESERVE_WHITESPACE</span><span class="p">:</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="n">padfn</span> <span class="o">=</span> <span class="n">_padleft</span>
    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">PRESERVE_WHITESPACE</span><span class="p">:</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="n">padfn</span> <span class="o">=</span> <span class="n">_padboth</span>
    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;decimal&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">has_invisible</span><span class="p">:</span>
            <span class="n">decimals</span> <span class="o">=</span> <span class="p">[</span><span class="n">_afterpoint</span><span class="p">(</span><span class="n">_strip_ansi</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">decimals</span> <span class="o">=</span> <span class="p">[</span><span class="n">_afterpoint</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="n">maxdecimals</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">decimals</span><span class="p">)</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="o">+</span> <span class="p">(</span><span class="n">maxdecimals</span> <span class="o">-</span> <span class="n">decs</span><span class="p">)</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">decs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">decimals</span><span class="p">)]</span>
        <span class="n">padfn</span> <span class="o">=</span> <span class="n">_padleft</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">alignment</span><span class="p">:</span>
        <span class="n">padfn</span> <span class="o">=</span> <span class="n">_padnone</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">PRESERVE_WHITESPACE</span><span class="p">:</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="n">padfn</span> <span class="o">=</span> <span class="n">_padright</span>
    <span class="k">return</span> <span class="n">strings</span><span class="p">,</span> <span class="n">padfn</span>


<span class="k">def</span> <span class="nf">_align_column_choose_width_fn</span><span class="p">(</span><span class="n">has_invisible</span><span class="p">,</span> <span class="n">enable_widechars</span><span class="p">,</span> <span class="n">is_multiline</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">has_invisible</span><span class="p">:</span>
        <span class="n">line_width_fn</span> <span class="o">=</span> <span class="n">_visible_width</span>
    <span class="k">elif</span> <span class="n">enable_widechars</span><span class="p">:</span>  <span class="c1"># optional wide-character support if available</span>
        <span class="n">line_width_fn</span> <span class="o">=</span> <span class="n">wcwidth</span><span class="o">.</span><span class="n">wcswidth</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">line_width_fn</span> <span class="o">=</span> <span class="nb">len</span>
    <span class="k">if</span> <span class="n">is_multiline</span><span class="p">:</span>
        <span class="n">width_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">_align_column_multiline_width</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">line_width_fn</span><span class="p">)</span>  <span class="c1"># noqa</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">width_fn</span> <span class="o">=</span> <span class="n">line_width_fn</span>
    <span class="k">return</span> <span class="n">width_fn</span>


<span class="k">def</span> <span class="nf">_align_column_multiline_width</span><span class="p">(</span><span class="n">multiline_s</span><span class="p">,</span> <span class="n">line_width_fn</span><span class="o">=</span><span class="nb">len</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visible width of a potentially multiline content.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">line_width_fn</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[</span><span class="se">\r\n</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">multiline_s</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">_flat_list</span><span class="p">(</span><span class="n">nested_list</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nested_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">subitem</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subitem</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>


<span class="k">def</span> <span class="nf">_align_column</span><span class="p">(</span>
    <span class="n">strings</span><span class="p">,</span>
    <span class="n">alignment</span><span class="p">,</span>
    <span class="n">minwidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">has_invisible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">enable_widechars</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">is_multiline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[string] -&gt; [padded_string]&quot;&quot;&quot;</span>
    <span class="n">strings</span><span class="p">,</span> <span class="n">padfn</span> <span class="o">=</span> <span class="n">_align_column_choose_padfn</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">has_invisible</span><span class="p">)</span>
    <span class="n">width_fn</span> <span class="o">=</span> <span class="n">_align_column_choose_width_fn</span><span class="p">(</span>
        <span class="n">has_invisible</span><span class="p">,</span> <span class="n">enable_widechars</span><span class="p">,</span> <span class="n">is_multiline</span>
    <span class="p">)</span>

    <span class="n">s_widths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">width_fn</span><span class="p">,</span> <span class="n">strings</span><span class="p">))</span>
    <span class="n">maxwidth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">_flat_list</span><span class="p">(</span><span class="n">s_widths</span><span class="p">)),</span> <span class="n">minwidth</span><span class="p">)</span>
    <span class="c1"># TODO: refactor column alignment in single-line and multiline modes</span>
    <span class="k">if</span> <span class="n">is_multiline</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">enable_widechars</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_invisible</span><span class="p">:</span>
            <span class="n">padded_strings</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">padfn</span><span class="p">(</span><span class="n">maxwidth</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">ms</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()])</span>
                <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">strings</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># enable wide-character width corrections</span>
            <span class="n">s_lens</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;[</span><span class="se">\r\n</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="p">)]</span> <span class="k">for</span> <span class="n">ms</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
            <span class="n">visible_widths</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="n">maxwidth</span> <span class="o">-</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mw</span><span class="p">,</span> <span class="n">ml</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">mw</span><span class="p">,</span> <span class="n">ml</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s_widths</span><span class="p">,</span> <span class="n">s_lens</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="c1"># wcswidth and _visible_width don&#39;t count invisible characters;</span>
            <span class="c1"># padfn doesn&#39;t need to apply another correction</span>
            <span class="n">padded_strings</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">padfn</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">((</span><span class="n">ms</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="ow">or</span> <span class="n">ms</span><span class="p">),</span> <span class="n">mw</span><span class="p">)])</span>
                <span class="k">for</span> <span class="n">ms</span><span class="p">,</span> <span class="n">mw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">visible_widths</span><span class="p">)</span>
            <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># single-line cell values</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">enable_widechars</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_invisible</span><span class="p">:</span>
            <span class="n">padded_strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">padfn</span><span class="p">(</span><span class="n">maxwidth</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># enable wide-character width corrections</span>
            <span class="n">s_lens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">strings</span><span class="p">))</span>
            <span class="n">visible_widths</span> <span class="o">=</span> <span class="p">[</span><span class="n">maxwidth</span> <span class="o">-</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s_widths</span><span class="p">,</span> <span class="n">s_lens</span><span class="p">)]</span>
            <span class="c1"># wcswidth and _visible_width don&#39;t count invisible characters;</span>
            <span class="c1"># padfn doesn&#39;t need to apply another correction</span>
            <span class="n">padded_strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">padfn</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">visible_widths</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">padded_strings</span>


<span class="k">def</span> <span class="nf">_more_generic</span><span class="p">(</span><span class="n">type1</span><span class="p">,</span> <span class="n">type2</span><span class="p">):</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nb">bool</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nb">int</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="nb">float</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">invtypes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">5</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">moregeneric</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">invtypes</span><span class="p">[</span><span class="n">moregeneric</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_column_type</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">has_invisible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">numparse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The least generic type all column values are convertible to.</span>

<span class="sd">    &gt;&gt;&gt; _column_type([True, False]) is bool</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _column_type([&quot;1&quot;, &quot;2&quot;]) is int</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _column_type([&quot;1&quot;, &quot;2.3&quot;]) is float</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _column_type([&quot;1&quot;, &quot;2.3&quot;, &quot;four&quot;]) is str</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _column_type([&quot;four&quot;, &#39;\u043f\u044f\u0442\u044c&#39;]) is str</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _column_type([None, &quot;brux&quot;]) is str</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; _column_type([1, 2, None]) is int</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; import datetime as dt</span>
<span class="sd">    &gt;&gt;&gt; _column_type([dt.datetime(1991,2,19), dt.time(17,35)]) is str</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="n">_type</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">has_invisible</span><span class="p">,</span> <span class="n">numparse</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">_more_generic</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_format</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">valtype</span><span class="p">,</span> <span class="n">floatfmt</span><span class="p">,</span> <span class="n">intfmt</span><span class="p">,</span> <span class="n">missingval</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">has_invisible</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format a value according to its type.</span>

<span class="sd">    Unicode is supported:</span>

<span class="sd">    &gt;&gt;&gt; hrow = [&#39;\u0431\u0443\u043a\u0432\u0430&#39;, &#39;\u0446\u0438\u0444\u0440\u0430&#39;] ; \</span>
<span class="sd">        tbl = [[&#39;\u0430\u0437&#39;, 2], [&#39;\u0431\u0443\u043a\u0438&#39;, 4]] ; \</span>
<span class="sd">        good_result = &#39;\\u0431\\u0443\\u043a\\u0432\\u0430      \\u0446\\u0438\\u0444\\u0440\\u0430\\n-------  -------\\n\\u0430\\u0437             2\\n\\u0431\\u0443\\u043a\\u0438           4&#39; ; \</span>
<span class="sd">        tabulate(tbl, headers=hrow) == good_result</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
    <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">missingval</span>

    <span class="k">if</span> <span class="n">valtype</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">valtype</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">intfmt</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">valtype</span> <span class="ow">is</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">&quot;ascii&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">valtype</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">is_a_colored_number</span> <span class="o">=</span> <span class="n">has_invisible</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">is_a_colored_number</span><span class="p">:</span>
            <span class="n">raw_val</span> <span class="o">=</span> <span class="n">_strip_ansi</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">formatted_val</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">raw_val</span><span class="p">),</span> <span class="n">floatfmt</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">raw_val</span><span class="p">,</span> <span class="n">formatted_val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">floatfmt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">def</span> <span class="nf">_align_header</span><span class="p">(</span>
    <span class="n">header</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">visible_width</span><span class="p">,</span> <span class="n">is_multiline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">width_fn</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="s2">&quot;Pad string header to width chars given known visible_width of the header.&quot;</span>
    <span class="k">if</span> <span class="n">is_multiline</span><span class="p">:</span>
        <span class="n">header_lines</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">_multiline_codes</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
        <span class="n">padded_lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_align_header</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">width_fn</span><span class="p">(</span><span class="n">h</span><span class="p">))</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header_lines</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">padded_lines</span><span class="p">)</span>
    <span class="c1"># else: not multiline</span>
    <span class="n">ninvisible</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)</span> <span class="o">-</span> <span class="n">visible_width</span>
    <span class="n">width</span> <span class="o">+=</span> <span class="n">ninvisible</span>
    <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_padright</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_padboth</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">alignment</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_padleft</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">header</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_remove_separating_lines</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">separating_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sans_rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_is_separating_line</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">separating_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sans_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sans_rows</span><span class="p">,</span> <span class="n">separating_lines</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_reinsert_separating_lines</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">separating_lines</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">separating_lines</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">separating_lines</span><span class="p">:</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">SEPARATING_LINE</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_prepend_row_index</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a left-most index column.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rows</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">Sized</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;index must be as long as the number of data rows: &quot;</span>
            <span class="o">+</span> <span class="s2">&quot;len(index)=</span><span class="si">{}</span><span class="s2"> len(rows)=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="n">sans_rows</span><span class="p">,</span> <span class="n">separating_lines</span> <span class="o">=</span> <span class="n">_remove_separating_lines</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
    <span class="n">new_rows</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">index_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sans_rows</span><span class="p">:</span>
        <span class="n">index_v</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">index_iter</span><span class="p">)</span>
        <span class="n">new_rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">index_v</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">new_rows</span>
    <span class="n">_reinsert_separating_lines</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">separating_lines</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rows</span>


<span class="k">def</span> <span class="nf">_bool</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="s2">&quot;A wrapper around standard bool() which doesn&#39;t throw on NumPy arrays&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># val is likely to be a numpy array with many elements</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_normalize_tabular_data</span><span class="p">(</span><span class="n">tabular_data</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform a supported data type to a list of lists, and a list of headers.</span>

<span class="sd">    Supported tabular data types:</span>

<span class="sd">    * list-of-lists or another iterable of iterables</span>

<span class="sd">    * list of named tuples (usually used with headers=&quot;keys&quot;)</span>

<span class="sd">    * list of dicts (usually used with headers=&quot;keys&quot;)</span>

<span class="sd">    * list of OrderedDicts (usually used with headers=&quot;keys&quot;)</span>

<span class="sd">    * list of dataclasses (Python 3.7+ only, usually used with headers=&quot;keys&quot;)</span>

<span class="sd">    * 2D NumPy arrays</span>

<span class="sd">    * NumPy record arrays (usually used with headers=&quot;keys&quot;)</span>

<span class="sd">    * dict of iterables (usually used with headers=&quot;keys&quot;)</span>

<span class="sd">    * pandas.DataFrame (usually used with headers=&quot;keys&quot;)</span>

<span class="sd">    The first row can be used as headers if headers=&quot;firstrow&quot;,</span>
<span class="sd">    column indices can be used as headers if headers=&quot;keys&quot;.</span>

<span class="sd">    If showindex=&quot;default&quot;, show row indices of the pandas.DataFrame.</span>
<span class="sd">    If showindex=&quot;always&quot;, show row indices for all types of data.</span>
<span class="sd">    If showindex=&quot;never&quot;, don&#39;t show row indices for all types of data.</span>
<span class="sd">    If showindex is an iterable, show its values as row indices.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="nb">bool</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">is_headers2bool_broken</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># noqa</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># numpy.ndarray, pandas.core.index.Index, ...</span>
        <span class="n">is_headers2bool_broken</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># noqa</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tabular_data</span><span class="p">,</span> <span class="s2">&quot;keys&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tabular_data</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">):</span>
        <span class="c1"># dict-like and pandas.DataFrame?</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tabular_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;__call__&quot;</span><span class="p">):</span>
            <span class="c1"># likely a conventional dict</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">tabular_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">izip_longest</span><span class="p">(</span><span class="o">*</span><span class="n">tabular_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="p">)</span>  <span class="c1"># columns have to be transposed</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tabular_data</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">):</span>
            <span class="c1"># values is a property, has .index =&gt; it&#39;s likely a pandas.DataFrame (pandas 0.11.0)</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tabular_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">showindex</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="s2">&quot;always&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">tabular_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tabular_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">keys</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tabular_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">keys</span><span class="p">[:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tabular_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">tabular_data</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># values matrix doesn&#39;t need to be transposed</span>
            <span class="c1"># for DataFrames add an index per default</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tabular_data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;tabular data doesn&#39;t appear to be a dict or a DataFrame&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">keys</span><span class="p">))</span>  <span class="c1"># headers should be strings</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># it&#39;s a usual iterable of iterables, or a NumPy array, or an iterable of dataclasses</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tabular_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rows</span><span class="p">:</span>
            <span class="c1"># an empty table (issue #81)</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tabular_data</span><span class="p">,</span> <span class="s2">&quot;dtype&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tabular_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;names&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># numpy record array</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">tabular_data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;_fields&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># namedtuple</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_fields</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;keys&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;values&quot;</span><span class="p">):</span>
            <span class="c1"># dict-like object</span>
            <span class="n">uniq_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># implements hashed lookup</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># storage for set</span>
            <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;firstrow&quot;</span><span class="p">:</span>
                <span class="n">firstdict</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{}</span>
                <span class="n">keys</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">firstdict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">uniq_keys</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1"># Save unique items in input order</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">uniq_keys</span><span class="p">:</span>
                        <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                        <span class="n">uniq_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span><span class="p">:</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="n">keys</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># a dict of headers for a list of dicts</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;firstrow&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">firstdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="n">headers</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;headers for a list of dicts is not a dict or a keyword&quot;</span>
                <span class="p">)</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[[</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>

        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tabular_data</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tabular_data</span><span class="p">,</span> <span class="s2">&quot;fetchone&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tabular_data</span><span class="p">,</span> <span class="s2">&quot;rowcount&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># Python Database API cursor object (PEP 0249)</span>
            <span class="c1"># print tabulate(cursor, headers=&#39;keys&#39;)</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">column</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">tabular_data</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>

        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">dataclasses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">is_dataclass</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="p">):</span>
            <span class="c1"># Python 3.7+&#39;s dataclass</span>
            <span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span><span class="p">:</span>
                <span class="n">headers</span> <span class="o">=</span> <span class="n">field_names</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="p">[[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">field_names</span><span class="p">]</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;keys&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># keys are column indices</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>

    <span class="c1"># take headers from the first row if necessary</span>
    <span class="k">if</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;firstrow&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>  <span class="c1"># headers should be strings</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="n">headers</span> <span class="o">==</span> <span class="s2">&quot;firstrow&quot;</span><span class="p">:</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
    <span class="c1">#    rows = list(map(list, rows))</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span> <span class="k">if</span> <span class="n">_is_separating_line</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">rows</span><span class="p">))</span>

    <span class="c1"># add or remove an index column</span>
    <span class="n">showindex_is_a_str</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">showindex</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">showindex</span> <span class="o">==</span> <span class="s2">&quot;default&quot;</span> <span class="ow">and</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">_prepend_row_index</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">showindex</span><span class="p">,</span> <span class="n">Sized</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">showindex_is_a_str</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">_prepend_row_index</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">showindex</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">showindex</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">showindex_is_a_str</span><span class="p">:</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">_prepend_row_index</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">showindex</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">showindex</span> <span class="o">==</span> <span class="s2">&quot;always&quot;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">_bool</span><span class="p">(</span><span class="n">showindex</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">showindex_is_a_str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)))</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">_prepend_row_index</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">showindex</span> <span class="o">==</span> <span class="s2">&quot;never&quot;</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">_bool</span><span class="p">(</span><span class="n">showindex</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">showindex_is_a_str</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="c1"># pad with empty headers for initial columns if necessary</span>
    <span class="k">if</span> <span class="n">headers</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">nhs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">nhs</span> <span class="o">&lt;</span> <span class="n">ncols</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ncols</span> <span class="o">-</span> <span class="n">nhs</span><span class="p">)</span> <span class="o">+</span> <span class="n">headers</span>

    <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="n">headers</span>


<span class="k">def</span> <span class="nf">_wrap_text_to_colwidths</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">numparses</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">numparses</span> <span class="o">=</span> <span class="n">_expand_iterable</span><span class="p">(</span><span class="n">numparses</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">list_of_lists</span><span class="p">:</span>
        <span class="n">new_row</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cell</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">numparse</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">numparses</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_isnumber</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="ow">and</span> <span class="n">numparse</span><span class="p">:</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wrapper</span> <span class="o">=</span> <span class="n">_CustomTextWrap</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
                <span class="c1"># Cast based on our internal type handling</span>
                <span class="c1"># Any future custom formatting of types (such as datetimes)</span>
                <span class="c1"># may need to be more explicit than just `str` of the object</span>
                <span class="n">casted_cell</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">if</span> <span class="n">_isnumber</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> <span class="k">else</span> <span class="n">_type</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">numparse</span><span class="p">)(</span><span class="n">cell</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">wrapped</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">casted_cell</span><span class="p">)</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wrapped</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span> <span class="nf">_to_str</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A type safe wrapper for converting a bytestring to str. This is essentially just</span>
<span class="sd">    a wrapper around .decode() intended for use with things like map(), but with some</span>
<span class="sd">    specific behavior:</span>

<span class="sd">    1. if the given parameter is not a bytestring, it is returned unmodified</span>
<span class="sd">    2. decode() is called for the given parameter and assumes utf8 encoding, but the</span>
<span class="sd">       default error behavior is changed from &#39;strict&#39; to &#39;ignore&#39;</span>

<span class="sd">    &gt;&gt;&gt; repr(_to_str(b&#39;foo&#39;))</span>
<span class="sd">    &quot;&#39;foo&#39;&quot;</span>

<span class="sd">    &gt;&gt;&gt; repr(_to_str(&#39;foo&#39;))</span>
<span class="sd">    &quot;&#39;foo&#39;&quot;</span>

<span class="sd">    &gt;&gt;&gt; repr(_to_str(42))</span>
<span class="sd">    &quot;&#39;42&#39;&quot;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


<div class="viewcode-block" id="tabulate"><a class="viewcode-back" href="../core.html#core.tabulate">[docs]</a><span class="k">def</span> <span class="nf">tabulate</span><span class="p">(</span>
    <span class="n">tabular_data</span><span class="p">,</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">(),</span>
    <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;simple&quot;</span><span class="p">,</span>
    <span class="n">floatfmt</span><span class="o">=</span><span class="n">_DEFAULT_FLOATFMT</span><span class="p">,</span>
    <span class="n">intfmt</span><span class="o">=</span><span class="n">_DEFAULT_INTFMT</span><span class="p">,</span>
    <span class="n">numalign</span><span class="o">=</span><span class="n">_DEFAULT_ALIGN</span><span class="p">,</span>
    <span class="n">stralign</span><span class="o">=</span><span class="n">_DEFAULT_ALIGN</span><span class="p">,</span>
    <span class="n">missingval</span><span class="o">=</span><span class="n">_DEFAULT_MISSINGVAL</span><span class="p">,</span>
    <span class="n">showindex</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">disable_numparse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">colalign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">maxcolwidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rowalign</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">maxheadercolwidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format a fixed width table for pretty printing.</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[1, 2.34], [-56, &quot;8.999&quot;], [&quot;2&quot;, &quot;10001&quot;]]))</span>
<span class="sd">    ---  ---------</span>
<span class="sd">      1      2.34</span>
<span class="sd">    -56      8.999</span>
<span class="sd">      2  10001</span>
<span class="sd">    ---  ---------</span>

<span class="sd">    The first required argument (`tabular_data`) can be a</span>
<span class="sd">    list-of-lists (or another iterable of iterables), a list of named</span>
<span class="sd">    tuples, a dictionary of iterables, an iterable of dictionaries,</span>
<span class="sd">    an iterable of dataclasses (Python 3.7+), a two-dimensional NumPy array,</span>
<span class="sd">    NumPy record array, or a Pandas&#39; dataframe.</span>


<span class="sd">    Table headers</span>
<span class="sd">    -------------</span>

<span class="sd">    To print nice column headers, supply the second argument (`headers`):</span>

<span class="sd">      - `headers` can be an explicit list of column headers</span>
<span class="sd">      - if `headers=&quot;firstrow&quot;`, then the first row of data is used</span>
<span class="sd">      - if `headers=&quot;keys&quot;`, then dictionary keys or column indices are used</span>

<span class="sd">    Otherwise a headerless table is produced.</span>

<span class="sd">    If the number of headers is less than the number of columns, they</span>
<span class="sd">    are supposed to be names of the last columns. This is consistent</span>
<span class="sd">    with the plain-text format of R and Pandas&#39; dataframes.</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;sex&quot;,&quot;age&quot;],[&quot;Alice&quot;,&quot;F&quot;,24],[&quot;Bob&quot;,&quot;M&quot;,19]],</span>
<span class="sd">    ...       headers=&quot;firstrow&quot;))</span>
<span class="sd">           sex      age</span>
<span class="sd">    -----  -----  -----</span>
<span class="sd">    Alice  F         24</span>
<span class="sd">    Bob    M         19</span>

<span class="sd">    By default, pandas.DataFrame data have an additional column called</span>
<span class="sd">    row index. To add a similar column to all other types of data,</span>
<span class="sd">    use `showindex=&quot;always&quot;` or `showindex=True`. To suppress row indices</span>
<span class="sd">    for all types of data, pass `showindex=&quot;never&quot; or `showindex=False`.</span>
<span class="sd">    To add a custom row index column, pass `showindex=some_iterable`.</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;F&quot;,24],[&quot;M&quot;,19]], showindex=&quot;always&quot;))</span>
<span class="sd">    -  -  --</span>
<span class="sd">    0  F  24</span>
<span class="sd">    1  M  19</span>
<span class="sd">    -  -  --</span>


<span class="sd">    Column alignment</span>
<span class="sd">    ----------------</span>

<span class="sd">    `tabulate` tries to detect column types automatically, and aligns</span>
<span class="sd">    the values properly. By default it aligns decimal points of the</span>
<span class="sd">    numbers (or flushes integer numbers to the right), and flushes</span>
<span class="sd">    everything else to the left. Possible column alignments</span>
<span class="sd">    (`numalign`, `stralign`) are: &quot;right&quot;, &quot;center&quot;, &quot;left&quot;, &quot;decimal&quot;</span>
<span class="sd">    (only for `numalign`), and None (to disable alignment).</span>


<span class="sd">    Table formats</span>
<span class="sd">    -------------</span>

<span class="sd">    `intfmt` is a format specification used for columns which</span>
<span class="sd">    contain numeric data without a decimal point. This can also be</span>
<span class="sd">    a list or tuple of format strings, one per column.</span>

<span class="sd">    `floatfmt` is a format specification used for columns which</span>
<span class="sd">    contain numeric data with a decimal point. This can also be</span>
<span class="sd">    a list or tuple of format strings, one per column.</span>

<span class="sd">    `None` values are replaced with a `missingval` string (like</span>
<span class="sd">    `floatfmt`, this can also be a list of values for different</span>
<span class="sd">    columns):</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 1, None],</span>
<span class="sd">    ...                 [&quot;eggs&quot;, 42, 3.14],</span>
<span class="sd">    ...                 [&quot;other&quot;, None, 2.7]], missingval=&quot;?&quot;))</span>
<span class="sd">    -----  --  ----</span>
<span class="sd">    spam    1  ?</span>
<span class="sd">    eggs   42  3.14</span>
<span class="sd">    other   ?  2.7</span>
<span class="sd">    -----  --  ----</span>

<span class="sd">    Various plain-text table formats (`tablefmt`) are supported:</span>
<span class="sd">    &#39;plain&#39;, &#39;simple&#39;, &#39;grid&#39;, &#39;pipe&#39;, &#39;orgtbl&#39;, &#39;rst&#39;, &#39;mediawiki&#39;,</span>
<span class="sd">    &#39;latex&#39;, &#39;latex_raw&#39;, &#39;latex_booktabs&#39;, &#39;latex_longtable&#39; and tsv.</span>
<span class="sd">    Variable `tabulate_formats`contains the list of currently supported formats.</span>

<span class="sd">    &quot;plain&quot; format doesn&#39;t use any pseudographics to draw tables,</span>
<span class="sd">    it separates columns with a double space:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                 [&quot;strings&quot;, &quot;numbers&quot;], &quot;plain&quot;))</span>
<span class="sd">    strings      numbers</span>
<span class="sd">    spam         41.9999</span>
<span class="sd">    eggs        451</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tablefmt=&quot;plain&quot;))</span>
<span class="sd">    spam   41.9999</span>
<span class="sd">    eggs  451</span>

<span class="sd">    &quot;simple&quot; format is like Pandoc simple_tables:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                 [&quot;strings&quot;, &quot;numbers&quot;], &quot;simple&quot;))</span>
<span class="sd">    strings      numbers</span>
<span class="sd">    ---------  ---------</span>
<span class="sd">    spam         41.9999</span>
<span class="sd">    eggs        451</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tablefmt=&quot;simple&quot;))</span>
<span class="sd">    ----  --------</span>
<span class="sd">    spam   41.9999</span>
<span class="sd">    eggs  451</span>
<span class="sd">    ----  --------</span>

<span class="sd">    &quot;grid&quot; is similar to tables produced by Emacs table.el package or</span>
<span class="sd">    Pandoc grid_tables:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;grid&quot;))</span>
<span class="sd">    +-----------+-----------+</span>
<span class="sd">    | strings   |   numbers |</span>
<span class="sd">    +===========+===========+</span>
<span class="sd">    | spam      |   41.9999 |</span>
<span class="sd">    +-----------+-----------+</span>
<span class="sd">    | eggs      |  451      |</span>
<span class="sd">    +-----------+-----------+</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tablefmt=&quot;grid&quot;))</span>
<span class="sd">    +------+----------+</span>
<span class="sd">    | spam |  41.9999 |</span>
<span class="sd">    +------+----------+</span>
<span class="sd">    | eggs | 451      |</span>
<span class="sd">    +------+----------+</span>

<span class="sd">    &quot;simple_grid&quot; draws a grid using single-line box-drawing</span>
<span class="sd">    characters:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;simple_grid&quot;))</span>
<span class="sd">    ┌───────────┬───────────┐</span>
<span class="sd">    │ strings   │   numbers │</span>
<span class="sd">    ├───────────┼───────────┤</span>
<span class="sd">    │ spam      │   41.9999 │</span>
<span class="sd">    ├───────────┼───────────┤</span>
<span class="sd">    │ eggs      │  451      │</span>
<span class="sd">    └───────────┴───────────┘</span>

<span class="sd">    &quot;rounded_grid&quot; draws a grid using single-line box-drawing</span>
<span class="sd">    characters with rounded corners:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;rounded_grid&quot;))</span>
<span class="sd">    ╭───────────┬───────────╮</span>
<span class="sd">    │ strings   │   numbers │</span>
<span class="sd">    ├───────────┼───────────┤</span>
<span class="sd">    │ spam      │   41.9999 │</span>
<span class="sd">    ├───────────┼───────────┤</span>
<span class="sd">    │ eggs      │  451      │</span>
<span class="sd">    ╰───────────┴───────────╯</span>

<span class="sd">    &quot;heavy_grid&quot; draws a grid using bold (thick) single-line box-drawing</span>
<span class="sd">    characters:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;heavy_grid&quot;))</span>
<span class="sd">    ┏━━━━━━━━━━━┳━━━━━━━━━━━┓</span>
<span class="sd">    ┃ strings   ┃   numbers ┃</span>
<span class="sd">    ┣━━━━━━━━━━━╋━━━━━━━━━━━┫</span>
<span class="sd">    ┃ spam      ┃   41.9999 ┃</span>
<span class="sd">    ┣━━━━━━━━━━━╋━━━━━━━━━━━┫</span>
<span class="sd">    ┃ eggs      ┃  451      ┃</span>
<span class="sd">    ┗━━━━━━━━━━━┻━━━━━━━━━━━┛</span>

<span class="sd">    &quot;mixed_grid&quot; draws a grid using a mix of light (thin) and heavy (thick) lines</span>
<span class="sd">    box-drawing characters:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;mixed_grid&quot;))</span>
<span class="sd">    ┍━━━━━━━━━━━┯━━━━━━━━━━━┑</span>
<span class="sd">    │ strings   │   numbers │</span>
<span class="sd">    ┝━━━━━━━━━━━┿━━━━━━━━━━━┥</span>
<span class="sd">    │ spam      │   41.9999 │</span>
<span class="sd">    ├───────────┼───────────┤</span>
<span class="sd">    │ eggs      │  451      │</span>
<span class="sd">    ┕━━━━━━━━━━━┷━━━━━━━━━━━┙</span>

<span class="sd">    &quot;double_grid&quot; draws a grid using double-line box-drawing</span>
<span class="sd">    characters:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;double_grid&quot;))</span>
<span class="sd">    ╔═══════════╦═══════════╗</span>
<span class="sd">    ║ strings   ║   numbers ║</span>
<span class="sd">    ╠═══════════╬═══════════╣</span>
<span class="sd">    ║ spam      ║   41.9999 ║</span>
<span class="sd">    ╠═══════════╬═══════════╣</span>
<span class="sd">    ║ eggs      ║  451      ║</span>
<span class="sd">    ╚═══════════╩═══════════╝</span>

<span class="sd">    &quot;fancy_grid&quot; draws a grid using a mix of single and</span>
<span class="sd">    double-line box-drawing characters:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;fancy_grid&quot;))</span>
<span class="sd">    ╒═══════════╤═══════════╕</span>
<span class="sd">    │ strings   │   numbers │</span>
<span class="sd">    ╞═══════════╪═══════════╡</span>
<span class="sd">    │ spam      │   41.9999 │</span>
<span class="sd">    ├───────────┼───────────┤</span>
<span class="sd">    │ eggs      │  451      │</span>
<span class="sd">    ╘═══════════╧═══════════╛</span>

<span class="sd">    &quot;outline&quot; is the same as the &quot;grid&quot; format but doesn&#39;t draw lines between rows:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;outline&quot;))</span>
<span class="sd">    +-----------+-----------+</span>
<span class="sd">    | strings   |   numbers |</span>
<span class="sd">    +===========+===========+</span>
<span class="sd">    | spam      |   41.9999 |</span>
<span class="sd">    | eggs      |  451      |</span>
<span class="sd">    +-----------+-----------+</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tablefmt=&quot;outline&quot;))</span>
<span class="sd">    +------+----------+</span>
<span class="sd">    | spam |  41.9999 |</span>
<span class="sd">    | eggs | 451      |</span>
<span class="sd">    +------+----------+</span>

<span class="sd">    &quot;simple_outline&quot; is the same as the &quot;simple_grid&quot; format but doesn&#39;t draw lines between rows:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;simple_outline&quot;))</span>
<span class="sd">    ┌───────────┬───────────┐</span>
<span class="sd">    │ strings   │   numbers │</span>
<span class="sd">    ├───────────┼───────────┤</span>
<span class="sd">    │ spam      │   41.9999 │</span>
<span class="sd">    │ eggs      │  451      │</span>
<span class="sd">    └───────────┴───────────┘</span>

<span class="sd">    &quot;rounded_outline&quot; is the same as the &quot;rounded_grid&quot; format but doesn&#39;t draw lines between rows:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;rounded_outline&quot;))</span>
<span class="sd">    ╭───────────┬───────────╮</span>
<span class="sd">    │ strings   │   numbers │</span>
<span class="sd">    ├───────────┼───────────┤</span>
<span class="sd">    │ spam      │   41.9999 │</span>
<span class="sd">    │ eggs      │  451      │</span>
<span class="sd">    ╰───────────┴───────────╯</span>

<span class="sd">    &quot;heavy_outline&quot; is the same as the &quot;heavy_grid&quot; format but doesn&#39;t draw lines between rows:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;heavy_outline&quot;))</span>
<span class="sd">    ┏━━━━━━━━━━━┳━━━━━━━━━━━┓</span>
<span class="sd">    ┃ strings   ┃   numbers ┃</span>
<span class="sd">    ┣━━━━━━━━━━━╋━━━━━━━━━━━┫</span>
<span class="sd">    ┃ spam      ┃   41.9999 ┃</span>
<span class="sd">    ┃ eggs      ┃  451      ┃</span>
<span class="sd">    ┗━━━━━━━━━━━┻━━━━━━━━━━━┛</span>

<span class="sd">    &quot;mixed_outline&quot; is the same as the &quot;mixed_grid&quot; format but doesn&#39;t draw lines between rows:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;mixed_outline&quot;))</span>
<span class="sd">    ┍━━━━━━━━━━━┯━━━━━━━━━━━┑</span>
<span class="sd">    │ strings   │   numbers │</span>
<span class="sd">    ┝━━━━━━━━━━━┿━━━━━━━━━━━┥</span>
<span class="sd">    │ spam      │   41.9999 │</span>
<span class="sd">    │ eggs      │  451      │</span>
<span class="sd">    ┕━━━━━━━━━━━┷━━━━━━━━━━━┙</span>

<span class="sd">    &quot;double_outline&quot; is the same as the &quot;double_grid&quot; format but doesn&#39;t draw lines between rows:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;double_outline&quot;))</span>
<span class="sd">    ╔═══════════╦═══════════╗</span>
<span class="sd">    ║ strings   ║   numbers ║</span>
<span class="sd">    ╠═══════════╬═══════════╣</span>
<span class="sd">    ║ spam      ║   41.9999 ║</span>
<span class="sd">    ║ eggs      ║  451      ║</span>
<span class="sd">    ╚═══════════╩═══════════╝</span>

<span class="sd">    &quot;fancy_outline&quot; is the same as the &quot;fancy_grid&quot; format but doesn&#39;t draw lines between rows:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;fancy_outline&quot;))</span>
<span class="sd">    ╒═══════════╤═══════════╕</span>
<span class="sd">    │ strings   │   numbers │</span>
<span class="sd">    ╞═══════════╪═══════════╡</span>
<span class="sd">    │ spam      │   41.9999 │</span>
<span class="sd">    │ eggs      │  451      │</span>
<span class="sd">    ╘═══════════╧═══════════╛</span>

<span class="sd">    &quot;pipe&quot; is like tables in PHP Markdown Extra extension or Pandoc</span>
<span class="sd">    pipe_tables:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;pipe&quot;))</span>
<span class="sd">    | strings   |   numbers |</span>
<span class="sd">    |:----------|----------:|</span>
<span class="sd">    | spam      |   41.9999 |</span>
<span class="sd">    | eggs      |  451      |</span>

<span class="sd">    &quot;presto&quot; is like tables produce by the Presto CLI:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;presto&quot;))</span>
<span class="sd">     strings   |   numbers</span>
<span class="sd">    -----------+-----------</span>
<span class="sd">     spam      |   41.9999</span>
<span class="sd">     eggs      |  451</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tablefmt=&quot;pipe&quot;))</span>
<span class="sd">    |:-----|---------:|</span>
<span class="sd">    | spam |  41.9999 |</span>
<span class="sd">    | eggs | 451      |</span>

<span class="sd">    &quot;orgtbl&quot; is like tables in Emacs org-mode and orgtbl-mode. They</span>
<span class="sd">    are slightly different from &quot;pipe&quot; format by not using colons to</span>
<span class="sd">    define column alignment, and using a &quot;+&quot; sign to indicate line</span>
<span class="sd">    intersections:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;orgtbl&quot;))</span>
<span class="sd">    | strings   |   numbers |</span>
<span class="sd">    |-----------+-----------|</span>
<span class="sd">    | spam      |   41.9999 |</span>
<span class="sd">    | eggs      |  451      |</span>


<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tablefmt=&quot;orgtbl&quot;))</span>
<span class="sd">    | spam |  41.9999 |</span>
<span class="sd">    | eggs | 451      |</span>

<span class="sd">    &quot;rst&quot; is like a simple table format from reStructuredText; please</span>
<span class="sd">    note that reStructuredText accepts also &quot;grid&quot; tables:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                [&quot;strings&quot;, &quot;numbers&quot;], &quot;rst&quot;))</span>
<span class="sd">    =========  =========</span>
<span class="sd">    strings      numbers</span>
<span class="sd">    =========  =========</span>
<span class="sd">    spam         41.9999</span>
<span class="sd">    eggs        451</span>
<span class="sd">    =========  =========</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tablefmt=&quot;rst&quot;))</span>
<span class="sd">    ====  ========</span>
<span class="sd">    spam   41.9999</span>
<span class="sd">    eggs  451</span>
<span class="sd">    ====  ========</span>

<span class="sd">    &quot;mediawiki&quot; produces a table markup used in Wikipedia and on other</span>
<span class="sd">    MediaWiki-based sites:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;strings&quot;, &quot;numbers&quot;], [&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                headers=&quot;firstrow&quot;, tablefmt=&quot;mediawiki&quot;))</span>
<span class="sd">    {| class=&quot;wikitable&quot; style=&quot;text-align: left;&quot;</span>
<span class="sd">    |+ &lt;!-- caption --&gt;</span>
<span class="sd">    |-</span>
<span class="sd">    ! strings   !! align=&quot;right&quot;|   numbers</span>
<span class="sd">    |-</span>
<span class="sd">    | spam      || align=&quot;right&quot;|   41.9999</span>
<span class="sd">    |-</span>
<span class="sd">    | eggs      || align=&quot;right&quot;|  451</span>
<span class="sd">    |}</span>

<span class="sd">    &quot;html&quot; produces HTML markup as an html.escape&#39;d str</span>
<span class="sd">    with a ._repr_html_ method so that Jupyter Lab and Notebook display the HTML</span>
<span class="sd">    and a .str property so that the raw HTML remains accessible</span>
<span class="sd">    the unsafehtml table format can be used if an unescaped HTML format is required:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;strings&quot;, &quot;numbers&quot;], [&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]],</span>
<span class="sd">    ...                headers=&quot;firstrow&quot;, tablefmt=&quot;html&quot;))</span>
<span class="sd">    &lt;table&gt;</span>
<span class="sd">    &lt;thead&gt;</span>
<span class="sd">    &lt;tr&gt;&lt;th&gt;strings  &lt;/th&gt;&lt;th style=&quot;text-align: right;&quot;&gt;  numbers&lt;/th&gt;&lt;/tr&gt;</span>
<span class="sd">    &lt;/thead&gt;</span>
<span class="sd">    &lt;tbody&gt;</span>
<span class="sd">    &lt;tr&gt;&lt;td&gt;spam     &lt;/td&gt;&lt;td style=&quot;text-align: right;&quot;&gt;  41.9999&lt;/td&gt;&lt;/tr&gt;</span>
<span class="sd">    &lt;tr&gt;&lt;td&gt;eggs     &lt;/td&gt;&lt;td style=&quot;text-align: right;&quot;&gt; 451     &lt;/td&gt;&lt;/tr&gt;</span>
<span class="sd">    &lt;/tbody&gt;</span>
<span class="sd">    &lt;/table&gt;</span>

<span class="sd">    &quot;latex&quot; produces a tabular environment of LaTeX document markup:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tablefmt=&quot;latex&quot;))</span>
<span class="sd">    \\begin{tabular}{lr}</span>
<span class="sd">    \\hline</span>
<span class="sd">     spam &amp;  41.9999 \\\\</span>
<span class="sd">     eggs &amp; 451      \\\\</span>
<span class="sd">    \\hline</span>
<span class="sd">    \\end{tabular}</span>

<span class="sd">    &quot;latex_raw&quot; is similar to &quot;latex&quot;, but doesn&#39;t escape special characters,</span>
<span class="sd">    such as backslash and underscore, so LaTeX commands may embedded into</span>
<span class="sd">    cells&#39; values:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam$_9$&quot;, 41.9999], [&quot;\\\\emph{eggs}&quot;, &quot;451.0&quot;]], tablefmt=&quot;latex_raw&quot;))</span>
<span class="sd">    \\begin{tabular}{lr}</span>
<span class="sd">    \\hline</span>
<span class="sd">     spam$_9$    &amp;  41.9999 \\\\</span>
<span class="sd">     \\emph{eggs} &amp; 451      \\\\</span>
<span class="sd">    \\hline</span>
<span class="sd">    \\end{tabular}</span>

<span class="sd">    &quot;latex_booktabs&quot; produces a tabular environment of LaTeX document markup</span>
<span class="sd">    using the booktabs.sty package:</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tablefmt=&quot;latex_booktabs&quot;))</span>
<span class="sd">    \\begin{tabular}{lr}</span>
<span class="sd">    \\toprule</span>
<span class="sd">     spam &amp;  41.9999 \\\\</span>
<span class="sd">     eggs &amp; 451      \\\\</span>
<span class="sd">    \\bottomrule</span>
<span class="sd">    \\end{tabular}</span>

<span class="sd">    &quot;latex_longtable&quot; produces a tabular environment that can stretch along</span>
<span class="sd">    multiple pages, using the longtable package for LaTeX.</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate([[&quot;spam&quot;, 41.9999], [&quot;eggs&quot;, &quot;451.0&quot;]], tablefmt=&quot;latex_longtable&quot;))</span>
<span class="sd">    \\begin{longtable}{lr}</span>
<span class="sd">    \\hline</span>
<span class="sd">     spam &amp;  41.9999 \\\\</span>
<span class="sd">     eggs &amp; 451      \\\\</span>
<span class="sd">    \\hline</span>
<span class="sd">    \\end{longtable}</span>


<span class="sd">    Number parsing</span>
<span class="sd">    --------------</span>
<span class="sd">    By default, anything which can be parsed as a number is a number.</span>
<span class="sd">    This ensures numbers represented as strings are aligned properly.</span>
<span class="sd">    This can lead to weird results for particular strings such as</span>
<span class="sd">    specific git SHAs e.g. &quot;42992e1&quot; will be parsed into the number</span>
<span class="sd">    429920 and aligned as such.</span>

<span class="sd">    To completely disable number parsing (and alignment), use</span>
<span class="sd">    `disable_numparse=True`. For more fine grained control, a list column</span>
<span class="sd">    indices is used to disable number parsing only on those columns</span>
<span class="sd">    e.g. `disable_numparse=[0, 2]` would disable number parsing only on the</span>
<span class="sd">    first and third columns.</span>

<span class="sd">    Column Widths and Auto Line Wrapping</span>
<span class="sd">    ------------------------------------</span>
<span class="sd">    Tabulate will, by default, set the width of each column to the length of the</span>
<span class="sd">    longest element in that column. However, in situations where fields are expected</span>
<span class="sd">    to reasonably be too long to look good as a single line, tabulate can help automate</span>
<span class="sd">    word wrapping long fields for you. Use the parameter `maxcolwidth` to provide a</span>
<span class="sd">    list of maximal column widths</span>

<span class="sd">    &gt;&gt;&gt; print(tabulate( \</span>
<span class="sd">          [(&#39;1&#39;, &#39;John Smith&#39;, \</span>
<span class="sd">            &#39;This is a rather long description that might look better if it is wrapped a bit&#39;)], \</span>
<span class="sd">          headers=(&quot;Issue Id&quot;, &quot;Author&quot;, &quot;Description&quot;), \</span>
<span class="sd">          maxcolwidths=[None, None, 30], \</span>
<span class="sd">          tablefmt=&quot;grid&quot;  \</span>
<span class="sd">        ))</span>
<span class="sd">    +------------+------------+-------------------------------+</span>
<span class="sd">    |   Issue Id | Author     | Description                   |</span>
<span class="sd">    +============+============+===============================+</span>
<span class="sd">    |          1 | John Smith | This is a rather long         |</span>
<span class="sd">    |            |            | description that might look   |</span>
<span class="sd">    |            |            | better if it is wrapped a bit |</span>
<span class="sd">    +------------+------------+-------------------------------+</span>

<span class="sd">    Header column width can be specified in a similar way using `maxheadercolwidth`</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">tabular_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tabular_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">list_of_lists</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">_normalize_tabular_data</span><span class="p">(</span>
        <span class="n">tabular_data</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">showindex</span><span class="o">=</span><span class="n">showindex</span>
    <span class="p">)</span>
    <span class="n">list_of_lists</span><span class="p">,</span> <span class="n">separating_lines</span> <span class="o">=</span> <span class="n">_remove_separating_lines</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">maxcolwidths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">num_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maxcolwidths</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>  <span class="c1"># Expand scalar for all columns</span>
            <span class="n">maxcolwidths</span> <span class="o">=</span> <span class="n">_expand_iterable</span><span class="p">(</span><span class="n">maxcolwidths</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">maxcolwidths</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Ignore col width for any &#39;trailing&#39; columns</span>
            <span class="n">maxcolwidths</span> <span class="o">=</span> <span class="n">_expand_iterable</span><span class="p">(</span><span class="n">maxcolwidths</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">numparses</span> <span class="o">=</span> <span class="n">_expand_numparse</span><span class="p">(</span><span class="n">disable_numparse</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)</span>
        <span class="n">list_of_lists</span> <span class="o">=</span> <span class="n">_wrap_text_to_colwidths</span><span class="p">(</span>
            <span class="n">list_of_lists</span><span class="p">,</span> <span class="n">maxcolwidths</span><span class="p">,</span> <span class="n">numparses</span><span class="o">=</span><span class="n">numparses</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">maxheadercolwidths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">num_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maxheadercolwidths</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>  <span class="c1"># Expand scalar for all columns</span>
            <span class="n">maxheadercolwidths</span> <span class="o">=</span> <span class="n">_expand_iterable</span><span class="p">(</span>
                <span class="n">maxheadercolwidths</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">maxheadercolwidths</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Ignore col width for any &#39;trailing&#39; columns</span>
            <span class="n">maxheadercolwidths</span> <span class="o">=</span> <span class="n">_expand_iterable</span><span class="p">(</span><span class="n">maxheadercolwidths</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">numparses</span> <span class="o">=</span> <span class="n">_expand_numparse</span><span class="p">(</span><span class="n">disable_numparse</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">_wrap_text_to_colwidths</span><span class="p">(</span>
            <span class="p">[</span><span class="n">headers</span><span class="p">],</span> <span class="n">maxheadercolwidths</span><span class="p">,</span> <span class="n">numparses</span><span class="o">=</span><span class="n">numparses</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># empty values in the first column of RST tables should be escaped (issue #82)</span>
    <span class="c1"># &quot;&quot; should be escaped as &quot;\\ &quot; or &quot;..&quot;</span>
    <span class="k">if</span> <span class="n">tablefmt</span> <span class="o">==</span> <span class="s2">&quot;rst&quot;</span><span class="p">:</span>
        <span class="n">list_of_lists</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">_rst_escape_first_column</span><span class="p">(</span><span class="n">list_of_lists</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="c1"># PrettyTable formatting does not use any extra padding.</span>
    <span class="c1"># Numbers are not parsed and are treated the same as strings for alignment.</span>
    <span class="c1"># Check if pretty is the format being used and override the defaults so it</span>
    <span class="c1"># does not impact other formats.</span>
    <span class="n">min_padding</span> <span class="o">=</span> <span class="n">MIN_PADDING</span>
    <span class="k">if</span> <span class="n">tablefmt</span> <span class="o">==</span> <span class="s2">&quot;pretty&quot;</span><span class="p">:</span>
        <span class="n">min_padding</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">disable_numparse</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">numalign</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span> <span class="k">if</span> <span class="n">numalign</span> <span class="o">==</span> <span class="n">_DEFAULT_ALIGN</span> <span class="k">else</span> <span class="n">numalign</span>
        <span class="n">stralign</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span> <span class="k">if</span> <span class="n">stralign</span> <span class="o">==</span> <span class="n">_DEFAULT_ALIGN</span> <span class="k">else</span> <span class="n">stralign</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">numalign</span> <span class="o">=</span> <span class="s2">&quot;decimal&quot;</span> <span class="k">if</span> <span class="n">numalign</span> <span class="o">==</span> <span class="n">_DEFAULT_ALIGN</span> <span class="k">else</span> <span class="n">numalign</span>
        <span class="n">stralign</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span> <span class="k">if</span> <span class="n">stralign</span> <span class="o">==</span> <span class="n">_DEFAULT_ALIGN</span> <span class="k">else</span> <span class="n">stralign</span>

    <span class="c1"># optimization: look for ANSI control codes once,</span>
    <span class="c1"># enable smart width functions only if a control code is found</span>
    <span class="c1">#</span>
    <span class="c1"># convert the headers and rows into a single, tab-delimited string ensuring</span>
    <span class="c1"># that any bytestrings are decoded safely (i.e. errors ignored)</span>
    <span class="n">plain_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">chain</span><span class="p">(</span>
            <span class="c1"># headers</span>
            <span class="nb">map</span><span class="p">(</span><span class="n">_to_str</span><span class="p">,</span> <span class="n">headers</span><span class="p">),</span>
            <span class="c1"># rows: chain the rows together into a single iterable after mapping</span>
            <span class="c1"># the bytestring conversino to each cell value</span>
            <span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_to_str</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">list_of_lists</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">has_invisible</span> <span class="o">=</span> <span class="n">_ansi_codes</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">plain_text</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">enable_widechars</span> <span class="o">=</span> <span class="n">wcwidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">WIDE_CHARS_MODE</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tablefmt</span><span class="p">,</span> <span class="n">TableFormat</span><span class="p">)</span>
        <span class="ow">and</span> <span class="n">tablefmt</span> <span class="ow">in</span> <span class="n">multiline_formats</span>
        <span class="ow">and</span> <span class="n">_is_multiline</span><span class="p">(</span><span class="n">plain_text</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">tablefmt</span> <span class="o">=</span> <span class="n">multiline_formats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tablefmt</span><span class="p">,</span> <span class="n">tablefmt</span><span class="p">)</span>
        <span class="n">is_multiline</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_multiline</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">width_fn</span> <span class="o">=</span> <span class="n">_choose_width_fn</span><span class="p">(</span><span class="n">has_invisible</span><span class="p">,</span> <span class="n">enable_widechars</span><span class="p">,</span> <span class="n">is_multiline</span><span class="p">)</span>

    <span class="c1"># format rows and columns, convert numeric values to strings</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">izip_longest</span><span class="p">(</span><span class="o">*</span><span class="n">list_of_lists</span><span class="p">))</span>
    <span class="n">numparses</span> <span class="o">=</span> <span class="n">_expand_numparse</span><span class="p">(</span><span class="n">disable_numparse</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">))</span>
    <span class="n">coltypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">_column_type</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">numparse</span><span class="o">=</span><span class="n">np</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">np</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">numparses</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">floatfmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># old version</span>
        <span class="n">float_formats</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span>
            <span class="n">floatfmt</span>
        <span class="p">]</span>  <span class="c1"># just duplicate the string to use in each column</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># if floatfmt is list, tuple etc we have one per column</span>
        <span class="n">float_formats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">floatfmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">float_formats</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">float_formats</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">float_formats</span><span class="p">))</span> <span class="o">*</span> <span class="p">[</span><span class="n">_DEFAULT_FLOATFMT</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intfmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># old version</span>
        <span class="n">int_formats</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span>
            <span class="n">intfmt</span>
        <span class="p">]</span>  <span class="c1"># just duplicate the string to use in each column</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># if intfmt is list, tuple etc we have one per column</span>
        <span class="n">int_formats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">intfmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">int_formats</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">int_formats</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">int_formats</span><span class="p">))</span> <span class="o">*</span> <span class="p">[</span><span class="n">_DEFAULT_INTFMT</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">missingval</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">missing_vals</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">missingval</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">missing_vals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">missingval</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_vals</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="n">missing_vals</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_vals</span><span class="p">))</span> <span class="o">*</span> <span class="p">[</span><span class="n">_DEFAULT_MISSINGVAL</span><span class="p">])</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">_format</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">fl_fmt</span><span class="p">,</span> <span class="n">int_fmt</span><span class="p">,</span> <span class="n">miss_v</span><span class="p">,</span> <span class="n">has_invisible</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">fl_fmt</span><span class="p">,</span> <span class="n">int_fmt</span><span class="p">,</span> <span class="n">miss_v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="n">cols</span><span class="p">,</span> <span class="n">coltypes</span><span class="p">,</span> <span class="n">float_formats</span><span class="p">,</span> <span class="n">int_formats</span><span class="p">,</span> <span class="n">missing_vals</span>
        <span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># align columns</span>
    <span class="n">aligns</span> <span class="o">=</span> <span class="p">[</span><span class="n">numalign</span> <span class="k">if</span> <span class="n">ct</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="k">else</span> <span class="n">stralign</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">coltypes</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">colalign</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">colalign</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">align</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colalign</span><span class="p">):</span>
            <span class="n">aligns</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">align</span>
    <span class="n">minwidths</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span><span class="n">width_fn</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">+</span> <span class="n">min_padding</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">]</span> <span class="k">if</span> <span class="n">headers</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">_align_column</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">minw</span><span class="p">,</span> <span class="n">has_invisible</span><span class="p">,</span> <span class="n">enable_widechars</span><span class="p">,</span> <span class="n">is_multiline</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">minw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">aligns</span><span class="p">,</span> <span class="n">minwidths</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">headers</span><span class="p">:</span>
        <span class="c1"># align headers and add headers</span>
        <span class="n">t_cols</span> <span class="o">=</span> <span class="n">cols</span> <span class="ow">or</span> <span class="p">[[</span><span class="s2">&quot;&quot;</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">t_aligns</span> <span class="o">=</span> <span class="n">aligns</span> <span class="ow">or</span> <span class="p">[</span><span class="n">stralign</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">minwidths</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">minw</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">width_fn</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span> <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">c</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">minw</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">minwidths</span><span class="p">,</span> <span class="n">t_cols</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_align_header</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">minw</span><span class="p">,</span> <span class="n">width_fn</span><span class="p">(</span><span class="n">h</span><span class="p">),</span> <span class="n">is_multiline</span><span class="p">,</span> <span class="n">width_fn</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">minw</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">t_aligns</span><span class="p">,</span> <span class="n">minwidths</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">minwidths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">width_fn</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span> <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tablefmt</span><span class="p">,</span> <span class="n">TableFormat</span><span class="p">):</span>
        <span class="n">tablefmt</span> <span class="o">=</span> <span class="n">_table_formats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tablefmt</span><span class="p">,</span> <span class="n">_table_formats</span><span class="p">[</span><span class="s2">&quot;simple&quot;</span><span class="p">])</span>

    <span class="n">ra_default</span> <span class="o">=</span> <span class="n">rowalign</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rowalign</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">rowaligns</span> <span class="o">=</span> <span class="n">_expand_iterable</span><span class="p">(</span><span class="n">rowalign</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">),</span> <span class="n">ra_default</span><span class="p">)</span>
    <span class="n">_reinsert_separating_lines</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">separating_lines</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">_format_table</span><span class="p">(</span>
        <span class="n">tablefmt</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">minwidths</span><span class="p">,</span> <span class="n">aligns</span><span class="p">,</span> <span class="n">is_multiline</span><span class="p">,</span> <span class="n">rowaligns</span><span class="o">=</span><span class="n">rowaligns</span>
    <span class="p">)</span></div>


<span class="k">def</span> <span class="nf">_expand_numparse</span><span class="p">(</span><span class="n">disable_numparse</span><span class="p">,</span> <span class="n">column_count</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of bools of length `column_count` which indicates whether</span>
<span class="sd">    number parsing should be used on each column.</span>
<span class="sd">    If `disable_numparse` is a list of indices, each of those indices are False,</span>
<span class="sd">    and everything else is True.</span>
<span class="sd">    If `disable_numparse` is a bool, then the returned list is all the same.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">disable_numparse</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
        <span class="n">numparses</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="n">column_count</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">disable_numparse</span><span class="p">:</span>
            <span class="n">numparses</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">numparses</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="ow">not</span> <span class="n">disable_numparse</span><span class="p">]</span> <span class="o">*</span> <span class="n">column_count</span>


<span class="k">def</span> <span class="nf">_expand_iterable</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">num_desired</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Expands the `original` argument to return a return a list of</span>
<span class="sd">    length `num_desired`. If `original` is shorter than `num_desired`, it will</span>
<span class="sd">    be padded with the value in `default`.</span>
<span class="sd">    If `original` is not a list to begin with (i.e. scalar value) a list of</span>
<span class="sd">    length `num_desired` completely populated with `default will be returned</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">original</span> <span class="o">+</span> <span class="p">[</span><span class="n">default</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_desired</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">original</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">default</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_desired</span>


<span class="k">def</span> <span class="nf">_pad_row</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">padding</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">cells</span><span class="p">:</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">padding</span>
        <span class="n">padded_cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">pad</span> <span class="o">+</span> <span class="n">cell</span> <span class="o">+</span> <span class="n">pad</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">padded_cells</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cells</span>


<span class="k">def</span> <span class="nf">_build_simple_row</span><span class="p">(</span><span class="n">padded_cells</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">):</span>
    <span class="s2">&quot;Format row according to DataRow format without padding.&quot;</span>
    <span class="n">begin</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">rowfmt</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">begin</span> <span class="o">+</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">padded_cells</span><span class="p">)</span> <span class="o">+</span> <span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_build_row</span><span class="p">(</span><span class="n">padded_cells</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">):</span>
    <span class="s2">&quot;Return a string which represents a row of data cells.&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rowfmt</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rowfmt</span><span class="p">,</span> <span class="s2">&quot;__call__&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rowfmt</span><span class="p">(</span><span class="n">padded_cells</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_build_simple_row</span><span class="p">(</span><span class="n">padded_cells</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_append_basic_row</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">padded_cells</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">,</span> <span class="n">rowalign</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># NOTE: rowalign is ignored and exists for api compatibility with _append_multiline_row</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_build_row</span><span class="p">(</span><span class="n">padded_cells</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">lines</span>


<span class="k">def</span> <span class="nf">_align_cell_veritically</span><span class="p">(</span><span class="n">text_lines</span><span class="p">,</span> <span class="n">num_lines</span><span class="p">,</span> <span class="n">column_width</span><span class="p">,</span> <span class="n">row_alignment</span><span class="p">):</span>
    <span class="n">delta_lines</span> <span class="o">=</span> <span class="n">num_lines</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_lines</span><span class="p">)</span>
    <span class="n">blank</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="n">column_width</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">row_alignment</span> <span class="o">==</span> <span class="s2">&quot;bottom&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">blank</span> <span class="o">*</span> <span class="n">delta_lines</span> <span class="o">+</span> <span class="n">text_lines</span>
    <span class="k">elif</span> <span class="n">row_alignment</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
        <span class="n">top_delta</span> <span class="o">=</span> <span class="n">delta_lines</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">bottom_delta</span> <span class="o">=</span> <span class="n">delta_lines</span> <span class="o">-</span> <span class="n">top_delta</span>
        <span class="k">return</span> <span class="n">top_delta</span> <span class="o">*</span> <span class="n">blank</span> <span class="o">+</span> <span class="n">text_lines</span> <span class="o">+</span> <span class="n">bottom_delta</span> <span class="o">*</span> <span class="n">blank</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">text_lines</span> <span class="o">+</span> <span class="n">blank</span> <span class="o">*</span> <span class="n">delta_lines</span>


<span class="k">def</span> <span class="nf">_append_multiline_row</span><span class="p">(</span>
    <span class="n">lines</span><span class="p">,</span> <span class="n">padded_multiline_cells</span><span class="p">,</span> <span class="n">padded_widths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span> <span class="n">rowalign</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="n">colwidths</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pad</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">padded_widths</span><span class="p">]</span>
    <span class="n">cells_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">padded_multiline_cells</span><span class="p">]</span>
    <span class="n">nlines</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">cells_lines</span><span class="p">))</span>  <span class="c1"># number of lines in the row</span>
    <span class="c1"># vertically pad cells where some lines are missing</span>
    <span class="c1"># cells_lines = [</span>
    <span class="c1">#     (cl + [&quot; &quot; * w] * (nlines - len(cl))) for cl, w in zip(cells_lines, colwidths)</span>
    <span class="c1"># ]</span>

    <span class="n">cells_lines</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">_align_cell_veritically</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">nlines</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">rowalign</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cl</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cells_lines</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">lines_cells</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">cells_lines</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nlines</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">lines_cells</span><span class="p">:</span>
        <span class="n">padded_ln</span> <span class="o">=</span> <span class="n">_pad_row</span><span class="p">(</span><span class="n">ln</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span>
        <span class="n">_append_basic_row</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">padded_ln</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">rowfmt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lines</span>


<span class="k">def</span> <span class="nf">_build_line</span><span class="p">(</span><span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">linefmt</span><span class="p">):</span>
    <span class="s2">&quot;Return a string which represents a horizontal line.&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">linefmt</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">linefmt</span><span class="p">,</span> <span class="s2">&quot;__call__&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">linefmt</span><span class="p">(</span><span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">begin</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">linefmt</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[</span><span class="n">fill</span> <span class="o">*</span> <span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">colwidths</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">_build_simple_row</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_append_line</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">linefmt</span><span class="p">):</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_build_line</span><span class="p">(</span><span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">linefmt</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">lines</span>


<span class="k">class</span> <span class="nc">JupyterHTMLStr</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap the string with a _repr_html_ method so that Jupyter</span>
<span class="sd">    displays the HTML table&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;add a .str property so that the raw string is still accessible&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span>


<span class="k">def</span> <span class="nf">_format_table</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">colwidths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">is_multiline</span><span class="p">,</span> <span class="n">rowaligns</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce a plain-text representation of the table.&quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">hidden</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">with_header_hide</span> <span class="k">if</span> <span class="p">(</span><span class="n">headers</span> <span class="ow">and</span> <span class="n">fmt</span><span class="o">.</span><span class="n">with_header_hide</span><span class="p">)</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">padding</span>
    <span class="n">headerrow</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">headerrow</span>

    <span class="n">padded_widths</span> <span class="o">=</span> <span class="p">[(</span><span class="n">w</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pad</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">colwidths</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">is_multiline</span><span class="p">:</span>
        <span class="n">pad_row</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">row</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">row</span>  <span class="c1"># noqa do it later, in _append_multiline_row</span>
        <span class="n">append_row</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">_append_multiline_row</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pad_row</span> <span class="o">=</span> <span class="n">_pad_row</span>
        <span class="n">append_row</span> <span class="o">=</span> <span class="n">_append_basic_row</span>

    <span class="n">padded_headers</span> <span class="o">=</span> <span class="n">pad_row</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span>
    <span class="n">padded_rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">pad_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">pad</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lineabove</span> <span class="ow">and</span> <span class="s2">&quot;lineabove&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hidden</span><span class="p">:</span>
        <span class="n">_append_line</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">padded_widths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lineabove</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">padded_headers</span><span class="p">:</span>
        <span class="n">append_row</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">padded_headers</span><span class="p">,</span> <span class="n">padded_widths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">headerrow</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelowheader</span> <span class="ow">and</span> <span class="s2">&quot;linebelowheader&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hidden</span><span class="p">:</span>
            <span class="n">_append_line</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">padded_widths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelowheader</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">padded_rows</span> <span class="ow">and</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebetweenrows</span> <span class="ow">and</span> <span class="s2">&quot;linebetweenrows&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hidden</span><span class="p">:</span>
        <span class="c1"># initial rows with a line below</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">ralign</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">padded_rows</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rowaligns</span><span class="p">):</span>
            <span class="n">append_row</span><span class="p">(</span>
                <span class="n">lines</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">padded_widths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">datarow</span><span class="p">,</span> <span class="n">rowalign</span><span class="o">=</span><span class="n">ralign</span>
            <span class="p">)</span>
            <span class="n">_append_line</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">padded_widths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebetweenrows</span><span class="p">)</span>
        <span class="c1"># the last row without a line below</span>
        <span class="n">append_row</span><span class="p">(</span>
            <span class="n">lines</span><span class="p">,</span>
            <span class="n">padded_rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">padded_widths</span><span class="p">,</span>
            <span class="n">colaligns</span><span class="p">,</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">datarow</span><span class="p">,</span>
            <span class="n">rowalign</span><span class="o">=</span><span class="n">rowaligns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">separating_line</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">fmt</span><span class="o">.</span><span class="n">linebetweenrows</span>
            <span class="ow">or</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelowheader</span>
            <span class="ow">or</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelow</span>
            <span class="ow">or</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lineabove</span>
            <span class="ow">or</span> <span class="n">Line</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">padded_rows</span><span class="p">:</span>
            <span class="c1"># test to see if either the 1st column or the 2nd column (account for showindex) has</span>
            <span class="c1"># the SEPARATING_LINE flag</span>
            <span class="k">if</span> <span class="n">_is_separating_line</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">_append_line</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">padded_widths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">separating_line</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">append_row</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">padded_widths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">datarow</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelow</span> <span class="ow">and</span> <span class="s2">&quot;linebelow&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hidden</span><span class="p">:</span>
        <span class="n">_append_line</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">padded_widths</span><span class="p">,</span> <span class="n">colaligns</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">linebelow</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">headers</span> <span class="ow">or</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fmt</span><span class="o">.</span><span class="n">lineabove</span> <span class="o">==</span> <span class="n">_html_begin_table_without_header</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JupyterHTMLStr</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># a completely empty table</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>


<span class="k">class</span> <span class="nc">_CustomTextWrap</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">TextWrapper</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A custom implementation of CPython&#39;s textwrap.TextWrapper. This supports</span>
<span class="sd">    both wide characters (Korea, Japanese, Chinese)  - including mixed string.</span>
<span class="sd">    For the most part, the `_handle_long_word` and `_wrap_chunks` functions were</span>
<span class="sd">    copy pasted out of the CPython baseline, and updated with our custom length</span>
<span class="sd">    and line appending logic.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active_codes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_lines</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># For python2 compatibility</span>
        <span class="n">textwrap</span><span class="o">.</span><span class="n">TextWrapper</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_len</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Custom len that gets console column width for wide</span>
<span class="sd">        and non-wide characters as well as ignores color codes&quot;&quot;&quot;</span>
        <span class="n">stripped</span> <span class="o">=</span> <span class="n">_strip_ansi</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wcwidth</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wcwidth</span><span class="o">.</span><span class="n">wcswidth</span><span class="p">(</span><span class="n">stripped</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">stripped</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">new_line</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Adds a new line to the list of lines the text is being wrapped into</span>
<span class="sd">        This function will also track any ANSI color codes in this string as well</span>
<span class="sd">        as add any colors from previous lines order to preserve the same formatting</span>
<span class="sd">        as a single unwrapped string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">code_matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_ansi_codes</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">new_line</span><span class="p">)]</span>
        <span class="n">color_codes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">code</span><span class="o">.</span><span class="n">string</span><span class="p">[</span><span class="n">code</span><span class="o">.</span><span class="n">span</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">code</span><span class="o">.</span><span class="n">span</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">code_matches</span>
        <span class="p">]</span>

        <span class="c1"># Add color codes from earlier in the unwrapped line, and then track any new ones we add.</span>
        <span class="n">new_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_codes</span><span class="p">)</span> <span class="o">+</span> <span class="n">new_line</span>

        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">color_codes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">code</span> <span class="o">!=</span> <span class="n">_ansi_color_reset_code</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_active_codes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># A single reset code resets everything</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_active_codes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Always ensure each line is color terminted if any colors are</span>
        <span class="c1"># still active, otherwise colors will bleed into other cells on the console</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_active_codes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_line</span> <span class="o">=</span> <span class="n">new_line</span> <span class="o">+</span> <span class="n">_ansi_color_reset_code</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_line</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_long_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reversed_chunks</span><span class="p">,</span> <span class="n">cur_line</span><span class="p">,</span> <span class="n">cur_len</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_handle_long_word(chunks : [string],</span>
<span class="sd">                             cur_line : [string],</span>
<span class="sd">                             cur_len : int, width : int)</span>
<span class="sd">        Handle a chunk of text (most likely a word, not whitespace) that</span>
<span class="sd">        is too long to fit in any line.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Figure out when indent is larger than the specified width, and make</span>
        <span class="c1"># sure at least one character is stripped off on every pass</span>
        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">space_left</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">space_left</span> <span class="o">=</span> <span class="n">width</span> <span class="o">-</span> <span class="n">cur_len</span>

        <span class="c1"># If we&#39;re allowed to break long words, then do so: put as much</span>
        <span class="c1"># of the next chunk onto the current line as will fit.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">break_long_words</span><span class="p">:</span>
            <span class="c1"># Tabulate Custom: Build the string up piece-by-piece in order to</span>
            <span class="c1"># take each charcter&#39;s width into account</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">reversed_chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="n">chunk</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">space_left</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">cur_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">[:</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">reversed_chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">:]</span>

        <span class="c1"># Otherwise, we have to preserve the long word intact.  Only add</span>
        <span class="c1"># it to the current line if there&#39;s nothing already there --</span>
        <span class="c1"># that minimizes how much we violate the width constraint.</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">cur_line</span><span class="p">:</span>
            <span class="n">cur_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reversed_chunks</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>

        <span class="c1"># If we&#39;re not allowed to break long words, and there&#39;s already</span>
        <span class="c1"># text on the current line, do nothing.  Next time through the</span>
        <span class="c1"># main loop of _wrap_chunks(), we&#39;ll wind up here again, but</span>
        <span class="c1"># cur_len will be zero, so the next line will be entirely</span>
        <span class="c1"># devoted to the long word that we can&#39;t handle right now.</span>

    <span class="k">def</span> <span class="nf">_wrap_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;_wrap_chunks(chunks : [string]) -&gt; [string]</span>
<span class="sd">        Wrap a sequence of text chunks and return a list of lines of</span>
<span class="sd">        length &#39;self.width&#39; or less.  (If &#39;break_long_words&#39; is false,</span>
<span class="sd">        some lines may be longer than this.)  Chunks correspond roughly</span>
<span class="sd">        to words and the whitespace between them: each chunk is</span>
<span class="sd">        indivisible (modulo &#39;break_long_words&#39;), but a line break can</span>
<span class="sd">        come between any two chunks.  Chunks should not have internal</span>
<span class="sd">        whitespace; ie. a chunk is either all whitespace or a &quot;word&quot;.</span>
<span class="sd">        Whitespace chunks will be removed from the beginning and end of</span>
<span class="sd">        lines, but apart from that whitespace is preserved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;invalid width </span><span class="si">%r</span><span class="s2"> (must be &gt; 0)&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_lines</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_lines</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">indent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsequent_indent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_indent</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">placeholder</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;placeholder too large for max width&quot;</span><span class="p">)</span>

        <span class="c1"># Arrange in reverse order so items can be efficiently popped</span>
        <span class="c1"># from a stack of chucks.</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

        <span class="k">while</span> <span class="n">chunks</span><span class="p">:</span>

            <span class="c1"># Start the list of chunks that will make up the current line.</span>
            <span class="c1"># cur_len is just the length of all the chunks in cur_line.</span>
            <span class="n">cur_line</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cur_len</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Figure out which static string will prefix this line.</span>
            <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">indent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subsequent_indent</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">indent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_indent</span>

            <span class="c1"># Maximum width for this line.</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span>

            <span class="c1"># First chunk on line is whitespace -- drop it, unless this</span>
            <span class="c1"># is the very beginning of the text (ie. no lines started yet).</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_whitespace</span> <span class="ow">and</span> <span class="n">chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">lines</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">while</span> <span class="n">chunks</span><span class="p">:</span>
                <span class="n">chunk_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

                <span class="c1"># Can at least squeeze this chunk onto the current line.</span>
                <span class="k">if</span> <span class="n">cur_len</span> <span class="o">+</span> <span class="n">chunk_len</span> <span class="o">&lt;=</span> <span class="n">width</span><span class="p">:</span>
                    <span class="n">cur_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunks</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
                    <span class="n">cur_len</span> <span class="o">+=</span> <span class="n">chunk_len</span>

                <span class="c1"># Nope, this line is full.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="c1"># The current line is full, and the next chunk is too big to</span>
            <span class="c1"># fit on *any* line (not just this one).</span>
            <span class="k">if</span> <span class="n">chunks</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="n">chunks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">width</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_handle_long_word</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">cur_line</span><span class="p">,</span> <span class="n">cur_len</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
                <span class="n">cur_len</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">,</span> <span class="n">cur_line</span><span class="p">))</span>

            <span class="c1"># If the last chunk on this line is all whitespace, drop it.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_whitespace</span> <span class="ow">and</span> <span class="n">cur_line</span> <span class="ow">and</span> <span class="n">cur_line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">cur_len</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="n">cur_line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">cur_line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">cur_line</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_lines</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_lines</span>
                    <span class="ow">or</span> <span class="p">(</span>
                        <span class="ow">not</span> <span class="n">chunks</span>
                        <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_whitespace</span>
                        <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                        <span class="ow">and</span> <span class="ow">not</span> <span class="n">chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="ow">and</span> <span class="n">cur_len</span> <span class="o">&lt;=</span> <span class="n">width</span>
                <span class="p">):</span>
                    <span class="c1"># Convert current line back to a string and store it in</span>
                    <span class="c1"># list of all lines (return value).</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cur_line</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">while</span> <span class="n">cur_line</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">cur_line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                            <span class="ow">and</span> <span class="n">cur_len</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">placeholder</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">width</span>
                        <span class="p">):</span>
                            <span class="n">cur_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">placeholder</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cur_line</span><span class="p">))</span>
                            <span class="k">break</span>
                        <span class="n">cur_len</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="n">cur_line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">del</span> <span class="n">cur_line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
                            <span class="n">prev_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="n">prev_line</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">placeholder</span><span class="p">)</span>
                                <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
                            <span class="p">):</span>
                                <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">prev_line</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">placeholder</span>
                                <span class="k">break</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_update_lines</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">placeholder</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="n">lines</span>


<span class="k">def</span> <span class="nf">_main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">    Usage: tabulate [options] [FILE ...]</span>

<span class="sd">    Pretty-print tabular data.</span>
<span class="sd">    See also https://github.com/astanin/python-tabulate</span>

<span class="sd">    FILE                      a filename of the file with tabular data;</span>
<span class="sd">                              if &quot;-&quot; or missing, read data from stdin.</span>

<span class="sd">    Options:</span>

<span class="sd">    -h, --help                show this message</span>
<span class="sd">    -1, --header              use the first row of data as a table header</span>
<span class="sd">    -o FILE, --output FILE    print table to FILE (default: stdout)</span>
<span class="sd">    -s REGEXP, --sep REGEXP   use a custom column separator (default: whitespace)</span>
<span class="sd">    -F FPFMT, --float FPFMT   floating point number format (default: g)</span>
<span class="sd">    -I INTFMT, --int INTFMT   integer point number format (default: &quot;&quot;)</span>
<span class="sd">    -f FMT, --format FMT      set output table format; supported formats:</span>
<span class="sd">                              plain, simple, grid, fancy_grid, pipe, orgtbl,</span>
<span class="sd">                              rst, mediawiki, html, latex, latex_raw,</span>
<span class="sd">                              latex_booktabs, latex_longtable, tsv</span>
<span class="sd">                              (default: simple)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">getopt</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">textwrap</span>

    <span class="n">usage</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="n">_main</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">opts</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">(</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
            <span class="s2">&quot;h1o:s:F:A:f:&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">,</span> <span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="s2">&quot;output&quot;</span><span class="p">,</span> <span class="s2">&quot;sep=&quot;</span><span class="p">,</span> <span class="s2">&quot;float=&quot;</span><span class="p">,</span> <span class="s2">&quot;int=&quot;</span><span class="p">,</span> <span class="s2">&quot;align=&quot;</span><span class="p">,</span> <span class="s2">&quot;format=&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">getopt</span><span class="o">.</span><span class="n">GetoptError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">floatfmt</span> <span class="o">=</span> <span class="n">_DEFAULT_FLOATFMT</span>
    <span class="n">intfmt</span> <span class="o">=</span> <span class="n">_DEFAULT_INTFMT</span>
    <span class="n">colalign</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">tablefmt</span> <span class="o">=</span> <span class="s2">&quot;simple&quot;</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\s+&quot;</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
    <span class="k">for</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;-1&quot;</span><span class="p">,</span> <span class="s2">&quot;--header&quot;</span><span class="p">]:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="s2">&quot;firstrow&quot;</span>
        <span class="k">elif</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="s2">&quot;--output&quot;</span><span class="p">]:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;-F&quot;</span><span class="p">,</span> <span class="s2">&quot;--float&quot;</span><span class="p">]:</span>
            <span class="n">floatfmt</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;-I&quot;</span><span class="p">,</span> <span class="s2">&quot;--int&quot;</span><span class="p">]:</span>
            <span class="n">intfmt</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;-C&quot;</span><span class="p">,</span> <span class="s2">&quot;--colalign&quot;</span><span class="p">]:</span>
            <span class="n">colalign</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--format&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tabulate_formats</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a supported table format&quot;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">tablefmt</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--sep&quot;</span><span class="p">]:</span>
            <span class="n">sep</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;-h&quot;</span><span class="p">,</span> <span class="s2">&quot;--help&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span> <span class="k">else</span> <span class="n">args</span>
    <span class="k">with</span> <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="k">if</span> <span class="n">outfile</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span> <span class="k">else</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">out</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span>
            <span class="k">if</span> <span class="n">_is_file</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="n">_pprint_file</span><span class="p">(</span>
                    <span class="n">f</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                    <span class="n">tablefmt</span><span class="o">=</span><span class="n">tablefmt</span><span class="p">,</span>
                    <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span>
                    <span class="n">floatfmt</span><span class="o">=</span><span class="n">floatfmt</span><span class="p">,</span>
                    <span class="n">intfmt</span><span class="o">=</span><span class="n">intfmt</span><span class="p">,</span>
                    <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
                    <span class="n">colalign</span><span class="o">=</span><span class="n">colalign</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
                    <span class="n">_pprint_file</span><span class="p">(</span>
                        <span class="n">fobj</span><span class="p">,</span>
                        <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                        <span class="n">tablefmt</span><span class="o">=</span><span class="n">tablefmt</span><span class="p">,</span>
                        <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span>
                        <span class="n">floatfmt</span><span class="o">=</span><span class="n">floatfmt</span><span class="p">,</span>
                        <span class="n">intfmt</span><span class="o">=</span><span class="n">intfmt</span><span class="p">,</span>
                        <span class="n">file</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
                        <span class="n">colalign</span><span class="o">=</span><span class="n">colalign</span><span class="p">,</span>
                    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_pprint_file</span><span class="p">(</span><span class="n">fobject</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">tablefmt</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">floatfmt</span><span class="p">,</span> <span class="n">intfmt</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">colalign</span><span class="p">):</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">fobject</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">table</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="n">tabulate</span><span class="p">(</span>
            <span class="n">table</span><span class="p">,</span>
            <span class="n">headers</span><span class="p">,</span>
            <span class="n">tablefmt</span><span class="p">,</span>
            <span class="n">floatfmt</span><span class="o">=</span><span class="n">floatfmt</span><span class="p">,</span>
            <span class="n">intfmt</span><span class="o">=</span><span class="n">intfmt</span><span class="p">,</span>
            <span class="n">colalign</span><span class="o">=</span><span class="n">colalign</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">_main</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">MLV_toolbox_python</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">MLV_toolbox_python</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Dirk Bernhardt-Walther, Sadman Hossain.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>